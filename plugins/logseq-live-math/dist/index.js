"use strict";(()=>{var yo=Object.create;var vr=Object.defineProperty;var vo=Object.getOwnPropertyDescriptor;var bo=Object.getOwnPropertyNames;var _o=Object.getPrototypeOf,wo=Object.prototype.hasOwnProperty;var xo=(W,G)=>()=>(G||W((G={exports:{}}).exports,G),G.exports);var ko=(W,G,U,ut)=>{if(G&&typeof G=="object"||typeof G=="function")for(let F of bo(G))!wo.call(W,F)&&F!==U&&vr(W,F,{get:()=>G[F],enumerable:!(ut=vo(G,F))||ut.enumerable});return W};var Co=(W,G,U)=>(U=W!=null?yo(_o(W)):{},ko(G||!W||!W.__esModule?vr(U,"default",{value:W,enumerable:!0}):U,W));var br=xo((Ft,Bt)=>{(function(W,G){typeof Ft=="object"&&typeof Bt=="object"?Bt.exports=G():typeof define=="function"&&define.amd?define([],G):typeof Ft=="object"?Ft.LSPluginEntry=G():W.LSPluginEntry=G()})(self,()=>(()=>{var W={227:(F,u,j)=>{var v=j(155);u.formatArgs=function(A){if(A[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+A[0]+(this.useColors?"%c ":" ")+"+"+F.exports.humanize(this.diff),!this.useColors)return;let J="color: "+this.color;A.splice(1,0,J,"color: inherit");let w=0,h=0;A[0].replace(/%[a-zA-Z%]/g,k=>{k!=="%%"&&(w++,k==="%c"&&(h=w))}),A.splice(h,0,J)},u.save=function(A){try{A?u.storage.setItem("debug",A):u.storage.removeItem("debug")}catch{}},u.load=function(){let A;try{A=u.storage.getItem("debug")}catch{}return!A&&v!==void 0&&"env"in v&&(A=v.env.DEBUG),A},u.useColors=function(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},u.storage=function(){try{return localStorage}catch{}}(),u.destroy=(()=>{let A=!1;return()=>{A||(A=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),u.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],u.log=console.debug||console.log||(()=>{}),F.exports=j(447)(u);let{formatters:d}=F.exports;d.j=function(A){try{return JSON.stringify(A)}catch(J){return"[UnexpectedJSONParseError]: "+J.message}}},447:(F,u,j)=>{F.exports=function(v){function d(w){let h,k,p,_=null;function b(...x){if(!b.enabled)return;let R=b,T=Number(new Date),M=T-(h||T);R.diff=M,R.prev=h,R.curr=T,h=T,x[0]=d.coerce(x[0]),typeof x[0]!="string"&&x.unshift("%O");let i=0;x[0]=x[0].replace(/%([a-zA-Z%])/g,(l,g)=>{if(l==="%%")return"%";i++;let y=d.formatters[g];if(typeof y=="function"){let B=x[i];l=y.call(R,B),x.splice(i,1),i--}return l}),d.formatArgs.call(R,x),(R.log||d.log).apply(R,x)}return b.namespace=w,b.useColors=d.useColors(),b.color=d.selectColor(w),b.extend=A,b.destroy=d.destroy,Object.defineProperty(b,"enabled",{enumerable:!0,configurable:!1,get:()=>_!==null?_:(k!==d.namespaces&&(k=d.namespaces,p=d.enabled(w)),p),set:x=>{_=x}}),typeof d.init=="function"&&d.init(b),b}function A(w,h){let k=d(this.namespace+(h===void 0?":":h)+w);return k.log=this.log,k}function J(w){return w.toString().substring(2,w.toString().length-2).replace(/\.\*\?$/,"*")}return d.debug=d,d.default=d,d.coerce=function(w){return w instanceof Error?w.stack||w.message:w},d.disable=function(){let w=[...d.names.map(J),...d.skips.map(J).map(h=>"-"+h)].join(",");return d.enable(""),w},d.enable=function(w){let h;d.save(w),d.namespaces=w,d.names=[],d.skips=[];let k=(typeof w=="string"?w:"").split(/[\s,]+/),p=k.length;for(h=0;h<p;h++)k[h]&&((w=k[h].replace(/\*/g,".*?"))[0]==="-"?d.skips.push(new RegExp("^"+w.slice(1)+"$")):d.names.push(new RegExp("^"+w+"$")))},d.enabled=function(w){if(w[w.length-1]==="*")return!0;let h,k;for(h=0,k=d.skips.length;h<k;h++)if(d.skips[h].test(w))return!1;for(h=0,k=d.names.length;h<k;h++)if(d.names[h].test(w))return!0;return!1},d.humanize=j(824),d.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(v).forEach(w=>{d[w]=v[w]}),d.names=[],d.skips=[],d.formatters={},d.selectColor=function(w){let h=0;for(let k=0;k<w.length;k++)h=(h<<5)-h+w.charCodeAt(k),h|=0;return d.colors[Math.abs(h)%d.colors.length]},d.enable(d.load()),d}},996:F=>{"use strict";var u=function(p){return function(_){return!!_&&typeof _=="object"}(p)&&!function(_){var b=Object.prototype.toString.call(_);return b==="[object RegExp]"||b==="[object Date]"||function(x){return x.$$typeof===j}(_)}(p)},j=typeof Symbol=="function"&&Symbol.for?Symbol.for("react.element"):60103;function v(p,_){return _.clone!==!1&&_.isMergeableObject(p)?h((b=p,Array.isArray(b)?[]:{}),p,_):p;var b}function d(p,_,b){return p.concat(_).map(function(x){return v(x,b)})}function A(p){return Object.keys(p).concat(function(_){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(_).filter(function(b){return Object.propertyIsEnumerable.call(_,b)}):[]}(p))}function J(p,_){try{return _ in p}catch{return!1}}function w(p,_,b){var x={};return b.isMergeableObject(p)&&A(p).forEach(function(R){x[R]=v(p[R],b)}),A(_).forEach(function(R){(function(T,M){return J(T,M)&&!(Object.hasOwnProperty.call(T,M)&&Object.propertyIsEnumerable.call(T,M))})(p,R)||(J(p,R)&&b.isMergeableObject(_[R])?x[R]=function(T,M){if(!M.customMerge)return h;var i=M.customMerge(T);return typeof i=="function"?i:h}(R,b)(p[R],_[R],b):x[R]=v(_[R],b))}),x}function h(p,_,b){(b=b||{}).arrayMerge=b.arrayMerge||d,b.isMergeableObject=b.isMergeableObject||u,b.cloneUnlessOtherwiseSpecified=v;var x=Array.isArray(_);return x===Array.isArray(p)?x?b.arrayMerge(p,_,b):w(p,_,b):v(_,b)}h.all=function(p,_){if(!Array.isArray(p))throw new Error("first argument should be an array");return p.reduce(function(b,x){return h(b,x,_)},{})};var k=h;F.exports=k},856:function(F){F.exports=function(){"use strict";function u(E){return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},u(E)}function j(E,I){return j=Object.setPrototypeOf||function(H,X){return H.__proto__=X,H},j(E,I)}function v(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function d(E,I,H){return d=v()?Reflect.construct:function(X,ft,Pt){var Gt=[null];Gt.push.apply(Gt,ft);var ne=new(Function.bind.apply(X,Gt));return Pt&&j(ne,Pt.prototype),ne},d.apply(null,arguments)}function A(E){return J(E)||w(E)||h(E)||p()}function J(E){if(Array.isArray(E))return k(E)}function w(E){if(typeof Symbol<"u"&&E[Symbol.iterator]!=null||E["@@iterator"]!=null)return Array.from(E)}function h(E,I){if(E){if(typeof E=="string")return k(E,I);var H=Object.prototype.toString.call(E).slice(8,-1);return H==="Object"&&E.constructor&&(H=E.constructor.name),H==="Map"||H==="Set"?Array.from(E):H==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(H)?k(E,I):void 0}}function k(E,I){(I==null||I>E.length)&&(I=E.length);for(var H=0,X=new Array(I);H<I;H++)X[H]=E[H];return X}function p(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var _=Object.hasOwnProperty,b=Object.setPrototypeOf,x=Object.isFrozen,R=Object.getPrototypeOf,T=Object.getOwnPropertyDescriptor,M=Object.freeze,i=Object.seal,l=Object.create,g=typeof Reflect<"u"&&Reflect,y=g.apply,B=g.construct;y||(y=function(E,I,H){return E.apply(I,H)}),M||(M=function(E){return E}),i||(i=function(E){return E}),B||(B=function(E,I){return d(E,A(I))});var tt=nt(Array.prototype.forEach),et=nt(Array.prototype.pop),at=nt(Array.prototype.push),ht=nt(String.prototype.toLowerCase),mt=nt(String.prototype.match),$=nt(String.prototype.replace),xt=nt(String.prototype.indexOf),f=nt(String.prototype.trim),C=nt(RegExp.prototype.test),q=kt(TypeError);function nt(E){return function(I){for(var H=arguments.length,X=new Array(H>1?H-1:0),ft=1;ft<H;ft++)X[ft-1]=arguments[ft];return y(E,I,X)}}function kt(E){return function(){for(var I=arguments.length,H=new Array(I),X=0;X<I;X++)H[X]=arguments[X];return B(E,H)}}function N(E,I){b&&b(E,null);for(var H=I.length;H--;){var X=I[H];if(typeof X=="string"){var ft=ht(X);ft!==X&&(x(I)||(I[H]=ft),X=ft)}E[X]=!0}return E}function Y(E){var I,H=l(null);for(I in E)y(_,E,[I])&&(H[I]=E[I]);return H}function it(E,I){for(;E!==null;){var H=T(E,I);if(H){if(H.get)return nt(H.get);if(typeof H.value=="function")return nt(H.value)}E=R(E)}function X(ft){return console.warn("fallback value for",ft),null}return X}var Et=M(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),wt=M(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Mt=M(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),ee=M(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),dt=M(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),lt=M(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Ct=M(["#text"]),Ot=M(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),$t=M(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Yt=M(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Lt=M(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),At=i(/\{\{[\w\W]*|[\w\W]*\}\}/gm),fe=i(/<%[\w\W]*|[\w\W]*%>/gm),wn=i(/^data-[\-\w.\u00B7-\uFFFF]/),Nt=i(/^aria-[\-\w]+$/),Wt=i(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Ye=i(/^(?:\w+script|data):/i),xn=i(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),kn=i(/^html$/i),he=function(){return typeof window>"u"?null:window},Cn=function(E,I){if(u(E)!=="object"||typeof E.createPolicy!="function")return null;var H=null,X="data-tt-policy-suffix";I.currentScript&&I.currentScript.hasAttribute(X)&&(H=I.currentScript.getAttribute(X));var ft="dompurify"+(H?"#"+H:"");try{return E.createPolicy(ft,{createHTML:function(Pt){return Pt}})}catch{return console.warn("TrustedTypes policy "+ft+" could not be created."),null}};function Ze(){var E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:he(),I=function(o){return Ze(o)};if(I.version="2.3.8",I.removed=[],!E||!E.document||E.document.nodeType!==9)return I.isSupported=!1,I;var H=E.document,X=E.document,ft=E.DocumentFragment,Pt=E.HTMLTemplateElement,Gt=E.Node,ne=E.Element,$e=E.NodeFilter,Xe=E.NamedNodeMap,Zt=Xe===void 0?E.NamedNodeMap||E.MozNamedAttrMap:Xe,Sn=E.HTMLFormElement,En=E.DOMParser,On=E.trustedTypes,Se=ne.prototype,An=it(Se,"cloneNode"),jn=it(Se,"nextSibling"),Mn=it(Se,"childNodes"),Ne=it(Se,"parentNode");if(typeof Pt=="function"){var Rt=X.createElement("template");Rt.content&&Rt.content.ownerDocument&&(X=Rt.content.ownerDocument)}var Dt=Cn(On,H),Qe=Dt?Dt.createHTML(""):"",Ee=X,Pe=Ee.implementation,re=Ee.createNodeIterator,tn=Ee.createDocumentFragment,en=Ee.getElementsByTagName,Ln=H.importNode,nn={};try{nn=Y(X).documentMode?X.documentMode:{}}catch{}var Tt={};I.isSupported=typeof Ne=="function"&&Pe&&Pe.createHTMLDocument!==void 0&&nn!==9;var me,Jt,Oe=At,Ae=fe,Re=wn,Tn=Nt,rn=Ye,je=xn,rt=Wt,gt=null,on=N({},[].concat(A(Et),A(wt),A(Mt),A(dt),A(Ct))),yt=null,oe=N({},[].concat(A(Ot),A($t),A(Yt),A(Lt))),ct=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),ie=null,Me=null,De=!0,Ue=!0,sn=!1,se=!1,Xt=!1,qe=!1,ze=!1,ae=!1,Le=!1,le=!1,an=!0,He=!0,ce=!1,Ut={},ue=null,ln=N({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),cn=null,un=N({},["audio","video","img","source","image","track"]),Be=null,Qt=N({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),de="http://www.w3.org/1998/Math/MathML",We="http://www.w3.org/2000/svg",Kt="http://www.w3.org/1999/xhtml",Te=Kt,dn=!1,ge=["application/xhtml+xml","text/html"],ye="text/html",pe=null,In=X.createElement("form"),pn=function(o){return o instanceof RegExp||o instanceof Function},Ge=function(o){pe&&pe===o||(o&&u(o)==="object"||(o={}),o=Y(o),gt="ALLOWED_TAGS"in o?N({},o.ALLOWED_TAGS):on,yt="ALLOWED_ATTR"in o?N({},o.ALLOWED_ATTR):oe,Be="ADD_URI_SAFE_ATTR"in o?N(Y(Qt),o.ADD_URI_SAFE_ATTR):Qt,cn="ADD_DATA_URI_TAGS"in o?N(Y(un),o.ADD_DATA_URI_TAGS):un,ue="FORBID_CONTENTS"in o?N({},o.FORBID_CONTENTS):ln,ie="FORBID_TAGS"in o?N({},o.FORBID_TAGS):{},Me="FORBID_ATTR"in o?N({},o.FORBID_ATTR):{},Ut="USE_PROFILES"in o&&o.USE_PROFILES,De=o.ALLOW_ARIA_ATTR!==!1,Ue=o.ALLOW_DATA_ATTR!==!1,sn=o.ALLOW_UNKNOWN_PROTOCOLS||!1,se=o.SAFE_FOR_TEMPLATES||!1,Xt=o.WHOLE_DOCUMENT||!1,ae=o.RETURN_DOM||!1,Le=o.RETURN_DOM_FRAGMENT||!1,le=o.RETURN_TRUSTED_TYPE||!1,ze=o.FORCE_BODY||!1,an=o.SANITIZE_DOM!==!1,He=o.KEEP_CONTENT!==!1,ce=o.IN_PLACE||!1,rt=o.ALLOWED_URI_REGEXP||rt,Te=o.NAMESPACE||Kt,o.CUSTOM_ELEMENT_HANDLING&&pn(o.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(ct.tagNameCheck=o.CUSTOM_ELEMENT_HANDLING.tagNameCheck),o.CUSTOM_ELEMENT_HANDLING&&pn(o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(ct.attributeNameCheck=o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),o.CUSTOM_ELEMENT_HANDLING&&typeof o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(ct.allowCustomizedBuiltInElements=o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),me=me=ge.indexOf(o.PARSER_MEDIA_TYPE)===-1?ye:o.PARSER_MEDIA_TYPE,Jt=me==="application/xhtml+xml"?function(L){return L}:ht,se&&(Ue=!1),Le&&(ae=!0),Ut&&(gt=N({},A(Ct)),yt=[],Ut.html===!0&&(N(gt,Et),N(yt,Ot)),Ut.svg===!0&&(N(gt,wt),N(yt,$t),N(yt,Lt)),Ut.svgFilters===!0&&(N(gt,Mt),N(yt,$t),N(yt,Lt)),Ut.mathMl===!0&&(N(gt,dt),N(yt,Yt),N(yt,Lt))),o.ADD_TAGS&&(gt===on&&(gt=Y(gt)),N(gt,o.ADD_TAGS)),o.ADD_ATTR&&(yt===oe&&(yt=Y(yt)),N(yt,o.ADD_ATTR)),o.ADD_URI_SAFE_ATTR&&N(Be,o.ADD_URI_SAFE_ATTR),o.FORBID_CONTENTS&&(ue===ln&&(ue=Y(ue)),N(ue,o.FORBID_CONTENTS)),He&&(gt["#text"]=!0),Xt&&N(gt,["html","head","body"]),gt.table&&(N(gt,["tbody"]),delete ie.tbody),M&&M(o),pe=o)},fn=N({},["mi","mo","mn","ms","mtext"]),hn=N({},["foreignobject","desc","title","annotation-xml"]),Fn=N({},["title","style","font","a","script"]),qt=N({},wt);N(qt,Mt),N(qt,ee);var Ie=N({},dt);N(Ie,lt);var $n=function(o){var L=Ne(o);L&&L.tagName||(L={namespaceURI:Kt,tagName:"template"});var S=ht(o.tagName),ot=ht(L.tagName);return o.namespaceURI===We?L.namespaceURI===Kt?S==="svg":L.namespaceURI===de?S==="svg"&&(ot==="annotation-xml"||fn[ot]):!!qt[S]:o.namespaceURI===de?L.namespaceURI===Kt?S==="math":L.namespaceURI===We?S==="math"&&hn[ot]:!!Ie[S]:o.namespaceURI===Kt&&!(L.namespaceURI===We&&!hn[ot])&&!(L.namespaceURI===de&&!fn[ot])&&!Ie[S]&&(Fn[S]||!qt[S])},zt=function(o){at(I.removed,{element:o});try{o.parentNode.removeChild(o)}catch{try{o.outerHTML=Qe}catch{o.remove()}}},ve=function(o,L){try{at(I.removed,{attribute:L.getAttributeNode(o),from:L})}catch{at(I.removed,{attribute:null,from:L})}if(L.removeAttribute(o),o==="is"&&!yt[o])if(ae||Le)try{zt(L)}catch{}else try{L.setAttribute(o,"")}catch{}},mn=function(o){var L,S;if(ze)o="<remove></remove>"+o;else{var ot=mt(o,/^[\r\n\t ]+/);S=ot&&ot[0]}me==="application/xhtml+xml"&&(o='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+o+"</body></html>");var pt=Dt?Dt.createHTML(o):o;if(Te===Kt)try{L=new En().parseFromString(pt,me)}catch{}if(!L||!L.documentElement){L=Pe.createDocument(Te,"template",null);try{L.documentElement.innerHTML=dn?"":pt}catch{}}var _t=L.body||L.documentElement;return o&&S&&_t.insertBefore(X.createTextNode(S),_t.childNodes[0]||null),Te===Kt?en.call(L,Xt?"html":"body")[0]:Xt?L.documentElement:_t},gn=function(o){return re.call(o.ownerDocument||o,o,$e.SHOW_ELEMENT|$e.SHOW_COMMENT|$e.SHOW_TEXT,null,!1)},Nn=function(o){return o instanceof Sn&&(typeof o.nodeName!="string"||typeof o.textContent!="string"||typeof o.removeChild!="function"||!(o.attributes instanceof Zt)||typeof o.removeAttribute!="function"||typeof o.setAttribute!="function"||typeof o.namespaceURI!="string"||typeof o.insertBefore!="function")},be=function(o){return u(Gt)==="object"?o instanceof Gt:o&&u(o)==="object"&&typeof o.nodeType=="number"&&typeof o.nodeName=="string"},St=function(o,L,S){Tt[o]&&tt(Tt[o],function(ot){ot.call(I,L,S,pe)})},_e=function(o){var L;if(St("beforeSanitizeElements",o,null),Nn(o)||C(/[\u0080-\uFFFF]/,o.nodeName))return zt(o),!0;var S=Jt(o.nodeName);if(St("uponSanitizeElement",o,{tagName:S,allowedTags:gt}),o.hasChildNodes()&&!be(o.firstElementChild)&&(!be(o.content)||!be(o.content.firstElementChild))&&C(/<[/\w]/g,o.innerHTML)&&C(/<[/\w]/g,o.textContent)||S==="select"&&C(/<template/i,o.innerHTML))return zt(o),!0;if(!gt[S]||ie[S]){if(!ie[S]&&te(S)&&(ct.tagNameCheck instanceof RegExp&&C(ct.tagNameCheck,S)||ct.tagNameCheck instanceof Function&&ct.tagNameCheck(S)))return!1;if(He&&!ue[S]){var ot=Ne(o)||o.parentNode,pt=Mn(o)||o.childNodes;if(pt&&ot)for(var _t=pt.length-1;_t>=0;--_t)ot.insertBefore(An(pt[_t],!0),jn(o))}return zt(o),!0}return o instanceof ne&&!$n(o)?(zt(o),!0):S!=="noscript"&&S!=="noembed"||!C(/<\/no(script|embed)/i,o.innerHTML)?(se&&o.nodeType===3&&(L=o.textContent,L=$(L,Oe," "),L=$(L,Ae," "),o.textContent!==L&&(at(I.removed,{element:o.cloneNode()}),o.textContent=L)),St("afterSanitizeElements",o,null),!1):(zt(o),!0)},yn=function(o,L,S){if(an&&(L==="id"||L==="name")&&(S in X||S in In))return!1;if(!(Ue&&!Me[L]&&C(Re,L))){if(!(De&&C(Tn,L))){if(!yt[L]||Me[L]){if(!(te(o)&&(ct.tagNameCheck instanceof RegExp&&C(ct.tagNameCheck,o)||ct.tagNameCheck instanceof Function&&ct.tagNameCheck(o))&&(ct.attributeNameCheck instanceof RegExp&&C(ct.attributeNameCheck,L)||ct.attributeNameCheck instanceof Function&&ct.attributeNameCheck(L))||L==="is"&&ct.allowCustomizedBuiltInElements&&(ct.tagNameCheck instanceof RegExp&&C(ct.tagNameCheck,S)||ct.tagNameCheck instanceof Function&&ct.tagNameCheck(S))))return!1}else if(!Be[L]){if(!C(rt,$(S,je,""))){if((L!=="src"&&L!=="xlink:href"&&L!=="href"||o==="script"||xt(S,"data:")!==0||!cn[o])&&!(sn&&!C(rn,$(S,je,"")))){if(S)return!1}}}}}return!0},te=function(o){return o.indexOf("-")>0},we=function(o){var L,S,ot,pt;St("beforeSanitizeAttributes",o,null);var _t=o.attributes;if(_t){var vt={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:yt};for(pt=_t.length;pt--;){var xe=L=_t[pt],Vt=xe.name,jt=xe.namespaceURI;if(S=Vt==="value"?L.value:f(L.value),ot=Jt(Vt),vt.attrName=ot,vt.attrValue=S,vt.keepAttr=!0,vt.forceKeepAttr=void 0,St("uponSanitizeAttribute",o,vt),S=vt.attrValue,!vt.forceKeepAttr&&(ve(Vt,o),vt.keepAttr))if(C(/\/>/i,S))ve(Vt,o);else{se&&(S=$(S,Oe," "),S=$(S,Ae," "));var Je=Jt(o.nodeName);if(yn(Je,ot,S))try{jt?o.setAttributeNS(jt,Vt,S):o.setAttribute(Vt,S),et(I.removed)}catch{}}}St("afterSanitizeAttributes",o,null)}},Pn=function o(L){var S,ot=gn(L);for(St("beforeSanitizeShadowDOM",L,null);S=ot.nextNode();)St("uponSanitizeShadowNode",S,null),_e(S)||(S.content instanceof ft&&o(S.content),we(S));St("afterSanitizeShadowDOM",L,null)};return I.sanitize=function(o,L){var S,ot,pt,_t,vt;if((dn=!o)&&(o="<!-->"),typeof o!="string"&&!be(o)){if(typeof o.toString!="function")throw q("toString is not a function");if(typeof(o=o.toString())!="string")throw q("dirty is not a string, aborting")}if(!I.isSupported){if(u(E.toStaticHTML)==="object"||typeof E.toStaticHTML=="function"){if(typeof o=="string")return E.toStaticHTML(o);if(be(o))return E.toStaticHTML(o.outerHTML)}return o}if(qe||Ge(L),I.removed=[],typeof o=="string"&&(ce=!1),ce){if(o.nodeName){var xe=Jt(o.nodeName);if(!gt[xe]||ie[xe])throw q("root node is forbidden and cannot be sanitized in-place")}}else if(o instanceof Gt)(ot=(S=mn("<!---->")).ownerDocument.importNode(o,!0)).nodeType===1&&ot.nodeName==="BODY"||ot.nodeName==="HTML"?S=ot:S.appendChild(ot);else{if(!ae&&!se&&!Xt&&o.indexOf("<")===-1)return Dt&&le?Dt.createHTML(o):o;if(!(S=mn(o)))return ae?null:le?Qe:""}S&&ze&&zt(S.firstChild);for(var Vt=gn(ce?o:S);pt=Vt.nextNode();)pt.nodeType===3&&pt===_t||_e(pt)||(pt.content instanceof ft&&Pn(pt.content),we(pt),_t=pt);if(_t=null,ce)return o;if(ae){if(Le)for(vt=tn.call(S.ownerDocument);S.firstChild;)vt.appendChild(S.firstChild);else vt=S;return yt.shadowroot&&(vt=Ln.call(H,vt,!0)),vt}var jt=Xt?S.outerHTML:S.innerHTML;return Xt&&gt["!doctype"]&&S.ownerDocument&&S.ownerDocument.doctype&&S.ownerDocument.doctype.name&&C(kn,S.ownerDocument.doctype.name)&&(jt="<!DOCTYPE "+S.ownerDocument.doctype.name+`>
`+jt),se&&(jt=$(jt,Oe," "),jt=$(jt,Ae," ")),Dt&&le?Dt.createHTML(jt):jt},I.setConfig=function(o){Ge(o),qe=!0},I.clearConfig=function(){pe=null,qe=!1},I.isValidAttribute=function(o,L,S){pe||Ge({});var ot=Jt(o),pt=Jt(L);return yn(ot,pt,S)},I.addHook=function(o,L){typeof L=="function"&&(Tt[o]=Tt[o]||[],at(Tt[o],L))},I.removeHook=function(o){if(Tt[o])return et(Tt[o])},I.removeHooks=function(o){Tt[o]&&(Tt[o]=[])},I.removeAllHooks=function(){Tt={}},I}return Ze()}()},729:F=>{"use strict";var u=Object.prototype.hasOwnProperty,j="~";function v(){}function d(h,k,p){this.fn=h,this.context=k,this.once=p||!1}function A(h,k,p,_,b){if(typeof p!="function")throw new TypeError("The listener must be a function");var x=new d(p,_||h,b),R=j?j+k:k;return h._events[R]?h._events[R].fn?h._events[R]=[h._events[R],x]:h._events[R].push(x):(h._events[R]=x,h._eventsCount++),h}function J(h,k){--h._eventsCount==0?h._events=new v:delete h._events[k]}function w(){this._events=new v,this._eventsCount=0}Object.create&&(v.prototype=Object.create(null),new v().__proto__||(j=!1)),w.prototype.eventNames=function(){var h,k,p=[];if(this._eventsCount===0)return p;for(k in h=this._events)u.call(h,k)&&p.push(j?k.slice(1):k);return Object.getOwnPropertySymbols?p.concat(Object.getOwnPropertySymbols(h)):p},w.prototype.listeners=function(h){var k=j?j+h:h,p=this._events[k];if(!p)return[];if(p.fn)return[p.fn];for(var _=0,b=p.length,x=new Array(b);_<b;_++)x[_]=p[_].fn;return x},w.prototype.listenerCount=function(h){var k=j?j+h:h,p=this._events[k];return p?p.fn?1:p.length:0},w.prototype.emit=function(h,k,p,_,b,x){var R=j?j+h:h;if(!this._events[R])return!1;var T,M,i=this._events[R],l=arguments.length;if(i.fn){switch(i.once&&this.removeListener(h,i.fn,void 0,!0),l){case 1:return i.fn.call(i.context),!0;case 2:return i.fn.call(i.context,k),!0;case 3:return i.fn.call(i.context,k,p),!0;case 4:return i.fn.call(i.context,k,p,_),!0;case 5:return i.fn.call(i.context,k,p,_,b),!0;case 6:return i.fn.call(i.context,k,p,_,b,x),!0}for(M=1,T=new Array(l-1);M<l;M++)T[M-1]=arguments[M];i.fn.apply(i.context,T)}else{var g,y=i.length;for(M=0;M<y;M++)switch(i[M].once&&this.removeListener(h,i[M].fn,void 0,!0),l){case 1:i[M].fn.call(i[M].context);break;case 2:i[M].fn.call(i[M].context,k);break;case 3:i[M].fn.call(i[M].context,k,p);break;case 4:i[M].fn.call(i[M].context,k,p,_);break;default:if(!T)for(g=1,T=new Array(l-1);g<l;g++)T[g-1]=arguments[g];i[M].fn.apply(i[M].context,T)}}return!0},w.prototype.on=function(h,k,p){return A(this,h,k,p,!1)},w.prototype.once=function(h,k,p){return A(this,h,k,p,!0)},w.prototype.removeListener=function(h,k,p,_){var b=j?j+h:h;if(!this._events[b])return this;if(!k)return J(this,b),this;var x=this._events[b];if(x.fn)x.fn!==k||_&&!x.once||p&&x.context!==p||J(this,b);else{for(var R=0,T=[],M=x.length;R<M;R++)(x[R].fn!==k||_&&!x[R].once||p&&x[R].context!==p)&&T.push(x[R]);T.length?this._events[b]=T.length===1?T[0]:T:J(this,b)}return this},w.prototype.removeAllListeners=function(h){var k;return h?(k=j?j+h:h,this._events[k]&&J(this,k)):(this._events=new v,this._eventsCount=0),this},w.prototype.off=w.prototype.removeListener,w.prototype.addListener=w.prototype.on,w.prefixed=j,w.EventEmitter=w,F.exports=w},717:F=>{typeof Object.create=="function"?F.exports=function(u,j){u.super_=j,u.prototype=Object.create(j.prototype,{constructor:{value:u,enumerable:!1,writable:!0,configurable:!0}})}:F.exports=function(u,j){u.super_=j;var v=function(){};v.prototype=j.prototype,u.prototype=new v,u.prototype.constructor=u}},824:F=>{var u=1e3,j=60*u,v=60*j,d=24*v,A=7*d,J=365.25*d;function w(h,k,p,_){var b=k>=1.5*p;return Math.round(h/p)+" "+_+(b?"s":"")}F.exports=function(h,k){k=k||{};var p=typeof h;if(p==="string"&&h.length>0)return function(_){if(!((_=String(_)).length>100)){var b=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(_);if(b){var x=parseFloat(b[1]);switch((b[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return x*J;case"weeks":case"week":case"w":return x*A;case"days":case"day":case"d":return x*d;case"hours":case"hour":case"hrs":case"hr":case"h":return x*v;case"minutes":case"minute":case"mins":case"min":case"m":return x*j;case"seconds":case"second":case"secs":case"sec":case"s":return x*u;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return x;default:return}}}}(h);if(p==="number"&&isFinite(h))return k.long?function(_){var b=Math.abs(_);return b>=d?w(_,b,d,"day"):b>=v?w(_,b,v,"hour"):b>=j?w(_,b,j,"minute"):b>=u?w(_,b,u,"second"):_+" ms"}(h):function(_){var b=Math.abs(_);return b>=d?Math.round(_/d)+"d":b>=v?Math.round(_/v)+"h":b>=j?Math.round(_/j)+"m":b>=u?Math.round(_/u)+"s":_+"ms"}(h);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(h))}},520:(F,u,j)=>{"use strict";var v=j(155),d=v.platform==="win32",A=j(539);function J(i,l){for(var g=[],y=0;y<i.length;y++){var B=i[y];B&&B!=="."&&(B===".."?g.length&&g[g.length-1]!==".."?g.pop():l&&g.push(".."):g.push(B))}return g}function w(i){for(var l=i.length-1,g=0;g<=l&&!i[g];g++);for(var y=l;y>=0&&!i[y];y--);return g===0&&y===l?i:g>y?[]:i.slice(g,y+1)}var h=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,k=/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/,p={};function _(i){var l=h.exec(i),g=(l[1]||"")+(l[2]||""),y=l[3]||"",B=k.exec(y);return[g,B[1],B[2],B[3]]}function b(i){var l=h.exec(i),g=l[1]||"",y=!!g&&g[1]!==":";return{device:g,isUnc:y,isAbsolute:y||!!l[2],tail:l[3]}}function x(i){return"\\\\"+i.replace(/^[\\\/]+/,"").replace(/[\\\/]+/g,"\\")}p.resolve=function(){for(var i="",l="",g=!1,y=arguments.length-1;y>=-1;y--){var B;if(y>=0?B=arguments[y]:i?(B=v.env["="+i])&&B.substr(0,3).toLowerCase()===i.toLowerCase()+"\\"||(B=i+"\\"):B=v.cwd(),!A.isString(B))throw new TypeError("Arguments to path.resolve must be strings");if(B){var tt=b(B),et=tt.device,at=tt.isUnc,ht=tt.isAbsolute,mt=tt.tail;if((!et||!i||et.toLowerCase()===i.toLowerCase())&&(i||(i=et),g||(l=mt+"\\"+l,g=ht),i&&g))break}}return at&&(i=x(i)),i+(g?"\\":"")+(l=J(l.split(/[\\\/]+/),!g).join("\\"))||"."},p.normalize=function(i){var l=b(i),g=l.device,y=l.isUnc,B=l.isAbsolute,tt=l.tail,et=/[\\\/]$/.test(tt);return(tt=J(tt.split(/[\\\/]+/),!B).join("\\"))||B||(tt="."),tt&&et&&(tt+="\\"),y&&(g=x(g)),g+(B?"\\":"")+tt},p.isAbsolute=function(i){return b(i).isAbsolute},p.join=function(){for(var i=[],l=0;l<arguments.length;l++){var g=arguments[l];if(!A.isString(g))throw new TypeError("Arguments to path.join must be strings");g&&i.push(g)}var y=i.join("\\");return/^[\\\/]{2}[^\\\/]/.test(i[0])||(y=y.replace(/^[\\\/]{2,}/,"\\")),p.normalize(y)},p.relative=function(i,l){i=p.resolve(i),l=p.resolve(l);for(var g=i.toLowerCase(),y=l.toLowerCase(),B=w(l.split("\\")),tt=w(g.split("\\")),et=w(y.split("\\")),at=Math.min(tt.length,et.length),ht=at,mt=0;mt<at;mt++)if(tt[mt]!==et[mt]){ht=mt;break}if(ht==0)return l;var $=[];for(mt=ht;mt<tt.length;mt++)$.push("..");return($=$.concat(B.slice(ht))).join("\\")},p._makeLong=function(i){if(!A.isString(i))return i;if(!i)return"";var l=p.resolve(i);return/^[a-zA-Z]\:\\/.test(l)?"\\\\?\\"+l:/^\\\\[^?.]/.test(l)?"\\\\?\\UNC\\"+l.substring(2):i},p.dirname=function(i){var l=_(i),g=l[0],y=l[1];return g||y?(y&&(y=y.substr(0,y.length-1)),g+y):"."},p.basename=function(i,l){var g=_(i)[2];return l&&g.substr(-1*l.length)===l&&(g=g.substr(0,g.length-l.length)),g},p.extname=function(i){return _(i)[3]},p.format=function(i){if(!A.isObject(i))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof i);var l=i.root||"";if(!A.isString(l))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof i.root);var g=i.dir,y=i.base||"";return g?g[g.length-1]===p.sep?g+y:g+p.sep+y:y},p.parse=function(i){if(!A.isString(i))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof i);var l=_(i);if(!l||l.length!==4)throw new TypeError("Invalid path '"+i+"'");return{root:l[0],dir:l[0]+l[1].slice(0,-1),base:l[2],ext:l[3],name:l[2].slice(0,l[2].length-l[3].length)}},p.sep="\\",p.delimiter=";";var R=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,T={};function M(i){return R.exec(i).slice(1)}T.resolve=function(){for(var i="",l=!1,g=arguments.length-1;g>=-1&&!l;g--){var y=g>=0?arguments[g]:v.cwd();if(!A.isString(y))throw new TypeError("Arguments to path.resolve must be strings");y&&(i=y+"/"+i,l=y[0]==="/")}return(l?"/":"")+(i=J(i.split("/"),!l).join("/"))||"."},T.normalize=function(i){var l=T.isAbsolute(i),g=i&&i[i.length-1]==="/";return(i=J(i.split("/"),!l).join("/"))||l||(i="."),i&&g&&(i+="/"),(l?"/":"")+i},T.isAbsolute=function(i){return i.charAt(0)==="/"},T.join=function(){for(var i="",l=0;l<arguments.length;l++){var g=arguments[l];if(!A.isString(g))throw new TypeError("Arguments to path.join must be strings");g&&(i+=i?"/"+g:g)}return T.normalize(i)},T.relative=function(i,l){i=T.resolve(i).substr(1),l=T.resolve(l).substr(1);for(var g=w(i.split("/")),y=w(l.split("/")),B=Math.min(g.length,y.length),tt=B,et=0;et<B;et++)if(g[et]!==y[et]){tt=et;break}var at=[];for(et=tt;et<g.length;et++)at.push("..");return(at=at.concat(y.slice(tt))).join("/")},T._makeLong=function(i){return i},T.dirname=function(i){var l=M(i),g=l[0],y=l[1];return g||y?(y&&(y=y.substr(0,y.length-1)),g+y):"."},T.basename=function(i,l){var g=M(i)[2];return l&&g.substr(-1*l.length)===l&&(g=g.substr(0,g.length-l.length)),g},T.extname=function(i){return M(i)[3]},T.format=function(i){if(!A.isObject(i))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof i);var l=i.root||"";if(!A.isString(l))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof i.root);return(i.dir?i.dir+T.sep:"")+(i.base||"")},T.parse=function(i){if(!A.isString(i))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof i);var l=M(i);if(!l||l.length!==4)throw new TypeError("Invalid path '"+i+"'");return l[1]=l[1]||"",l[2]=l[2]||"",l[3]=l[3]||"",{root:l[0],dir:l[0]+l[1].slice(0,-1),base:l[2],ext:l[3],name:l[2].slice(0,l[2].length-l[3].length)}},T.sep="/",T.delimiter=":",F.exports=d?p:T,F.exports.posix=T,F.exports.win32=p},155:F=>{var u,j,v=F.exports={};function d(){throw new Error("setTimeout has not been defined")}function A(){throw new Error("clearTimeout has not been defined")}function J(T){if(u===setTimeout)return setTimeout(T,0);if((u===d||!u)&&setTimeout)return u=setTimeout,setTimeout(T,0);try{return u(T,0)}catch{try{return u.call(null,T,0)}catch{return u.call(this,T,0)}}}(function(){try{u=typeof setTimeout=="function"?setTimeout:d}catch{u=d}try{j=typeof clearTimeout=="function"?clearTimeout:A}catch{j=A}})();var w,h=[],k=!1,p=-1;function _(){k&&w&&(k=!1,w.length?h=w.concat(h):p=-1,h.length&&b())}function b(){if(!k){var T=J(_);k=!0;for(var M=h.length;M;){for(w=h,h=[];++p<M;)w&&w[p].run();p=-1,M=h.length}w=null,k=!1,function(i){if(j===clearTimeout)return clearTimeout(i);if((j===A||!j)&&clearTimeout)return j=clearTimeout,clearTimeout(i);try{j(i)}catch{try{return j.call(null,i)}catch{return j.call(this,i)}}}(T)}}function x(T,M){this.fun=T,this.array=M}function R(){}v.nextTick=function(T){var M=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)M[i-1]=arguments[i];h.push(new x(T,M)),h.length!==1||k||J(b)},x.prototype.run=function(){this.fun.apply(null,this.array)},v.title="browser",v.browser=!0,v.env={},v.argv=[],v.version="",v.versions={},v.on=R,v.addListener=R,v.once=R,v.off=R,v.removeListener=R,v.removeAllListeners=R,v.emit=R,v.prependListener=R,v.prependOnceListener=R,v.listeners=function(T){return[]},v.binding=function(T){throw new Error("process.binding is not supported")},v.cwd=function(){return"/"},v.chdir=function(T){throw new Error("process.chdir is not supported")},v.umask=function(){return 0}},384:F=>{F.exports=function(u){return u&&typeof u=="object"&&typeof u.copy=="function"&&typeof u.fill=="function"&&typeof u.readUInt8=="function"}},539:(F,u,j)=>{var v=j(155),d=/%[sdj%]/g;u.format=function(f){if(!i(f)){for(var C=[],q=0;q<arguments.length;q++)C.push(w(arguments[q]));return C.join(" ")}q=1;for(var nt=arguments,kt=nt.length,N=String(f).replace(d,function(it){if(it==="%%")return"%";if(q>=kt)return it;switch(it){case"%s":return String(nt[q++]);case"%d":return Number(nt[q++]);case"%j":try{return JSON.stringify(nt[q++])}catch{return"[Circular]"}default:return it}}),Y=nt[q];q<kt;Y=nt[++q])T(Y)||!y(Y)?N+=" "+Y:N+=" "+w(Y);return N},u.deprecate=function(f,C){if(l(j.g.process))return function(){return u.deprecate(f,C).apply(this,arguments)};if(v.noDeprecation===!0)return f;var q=!1;return function(){if(!q){if(v.throwDeprecation)throw new Error(C);v.traceDeprecation?console.trace(C):console.error(C),q=!0}return f.apply(this,arguments)}};var A,J={};function w(f,C){var q={seen:[],stylize:k};return arguments.length>=3&&(q.depth=arguments[2]),arguments.length>=4&&(q.colors=arguments[3]),R(C)?q.showHidden=C:C&&u._extend(q,C),l(q.showHidden)&&(q.showHidden=!1),l(q.depth)&&(q.depth=2),l(q.colors)&&(q.colors=!1),l(q.customInspect)&&(q.customInspect=!0),q.colors&&(q.stylize=h),p(q,f,q.depth)}function h(f,C){var q=w.styles[C];return q?"\x1B["+w.colors[q][0]+"m"+f+"\x1B["+w.colors[q][1]+"m":f}function k(f,C){return f}function p(f,C,q){if(f.customInspect&&C&&et(C.inspect)&&C.inspect!==u.inspect&&(!C.constructor||C.constructor.prototype!==C)){var nt=C.inspect(q,f);return i(nt)||(nt=p(f,nt,q)),nt}var kt=function(dt,lt){if(l(lt))return dt.stylize("undefined","undefined");if(i(lt)){var Ct="'"+JSON.stringify(lt).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return dt.stylize(Ct,"string")}if(M(lt))return dt.stylize(""+lt,"number");if(R(lt))return dt.stylize(""+lt,"boolean");if(T(lt))return dt.stylize("null","null")}(f,C);if(kt)return kt;var N=Object.keys(C),Y=function(dt){var lt={};return dt.forEach(function(Ct,Ot){lt[Ct]=!0}),lt}(N);if(f.showHidden&&(N=Object.getOwnPropertyNames(C)),tt(C)&&(N.indexOf("message")>=0||N.indexOf("description")>=0))return _(C);if(N.length===0){if(et(C)){var it=C.name?": "+C.name:"";return f.stylize("[Function"+it+"]","special")}if(g(C))return f.stylize(RegExp.prototype.toString.call(C),"regexp");if(B(C))return f.stylize(Date.prototype.toString.call(C),"date");if(tt(C))return _(C)}var Et,wt="",Mt=!1,ee=["{","}"];return x(C)&&(Mt=!0,ee=["[","]"]),et(C)&&(wt=" [Function"+(C.name?": "+C.name:"")+"]"),g(C)&&(wt=" "+RegExp.prototype.toString.call(C)),B(C)&&(wt=" "+Date.prototype.toUTCString.call(C)),tt(C)&&(wt=" "+_(C)),N.length!==0||Mt&&C.length!=0?q<0?g(C)?f.stylize(RegExp.prototype.toString.call(C),"regexp"):f.stylize("[Object]","special"):(f.seen.push(C),Et=Mt?function(dt,lt,Ct,Ot,$t){for(var Yt=[],Lt=0,At=lt.length;Lt<At;++Lt)xt(lt,String(Lt))?Yt.push(b(dt,lt,Ct,Ot,String(Lt),!0)):Yt.push("");return $t.forEach(function(fe){fe.match(/^\d+$/)||Yt.push(b(dt,lt,Ct,Ot,fe,!0))}),Yt}(f,C,q,Y,N):N.map(function(dt){return b(f,C,q,Y,dt,Mt)}),f.seen.pop(),function(dt,lt,Ct){return dt.reduce(function(Ot,$t){return $t.indexOf(`
`)>=0,Ot+$t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?Ct[0]+(lt===""?"":lt+`
 `)+" "+dt.join(`,
  `)+" "+Ct[1]:Ct[0]+lt+" "+dt.join(", ")+" "+Ct[1]}(Et,wt,ee)):ee[0]+wt+ee[1]}function _(f){return"["+Error.prototype.toString.call(f)+"]"}function b(f,C,q,nt,kt,N){var Y,it,Et;if((Et=Object.getOwnPropertyDescriptor(C,kt)||{value:C[kt]}).get?it=Et.set?f.stylize("[Getter/Setter]","special"):f.stylize("[Getter]","special"):Et.set&&(it=f.stylize("[Setter]","special")),xt(nt,kt)||(Y="["+kt+"]"),it||(f.seen.indexOf(Et.value)<0?(it=T(q)?p(f,Et.value,null):p(f,Et.value,q-1)).indexOf(`
`)>-1&&(it=N?it.split(`
`).map(function(wt){return"  "+wt}).join(`
`).substr(2):`
`+it.split(`
`).map(function(wt){return"   "+wt}).join(`
`)):it=f.stylize("[Circular]","special")),l(Y)){if(N&&kt.match(/^\d+$/))return it;(Y=JSON.stringify(""+kt)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(Y=Y.substr(1,Y.length-2),Y=f.stylize(Y,"name")):(Y=Y.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),Y=f.stylize(Y,"string"))}return Y+": "+it}function x(f){return Array.isArray(f)}function R(f){return typeof f=="boolean"}function T(f){return f===null}function M(f){return typeof f=="number"}function i(f){return typeof f=="string"}function l(f){return f===void 0}function g(f){return y(f)&&at(f)==="[object RegExp]"}function y(f){return typeof f=="object"&&f!==null}function B(f){return y(f)&&at(f)==="[object Date]"}function tt(f){return y(f)&&(at(f)==="[object Error]"||f instanceof Error)}function et(f){return typeof f=="function"}function at(f){return Object.prototype.toString.call(f)}function ht(f){return f<10?"0"+f.toString(10):f.toString(10)}u.debuglog=function(f){if(l(A)&&(A=v.env.NODE_DEBUG||""),f=f.toUpperCase(),!J[f])if(new RegExp("\\b"+f+"\\b","i").test(A)){var C=v.pid;J[f]=function(){var q=u.format.apply(u,arguments);console.error("%s %d: %s",f,C,q)}}else J[f]=function(){};return J[f]},u.inspect=w,w.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},w.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},u.isArray=x,u.isBoolean=R,u.isNull=T,u.isNullOrUndefined=function(f){return f==null},u.isNumber=M,u.isString=i,u.isSymbol=function(f){return typeof f=="symbol"},u.isUndefined=l,u.isRegExp=g,u.isObject=y,u.isDate=B,u.isError=tt,u.isFunction=et,u.isPrimitive=function(f){return f===null||typeof f=="boolean"||typeof f=="number"||typeof f=="string"||typeof f=="symbol"||f===void 0},u.isBuffer=j(384);var mt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function $(){var f=new Date,C=[ht(f.getHours()),ht(f.getMinutes()),ht(f.getSeconds())].join(":");return[f.getDate(),mt[f.getMonth()],C].join(" ")}function xt(f,C){return Object.prototype.hasOwnProperty.call(f,C)}u.log=function(){console.log("%s - %s",$(),u.format.apply(u,arguments))},u.inherits=j(717),u._extend=function(f,C){if(!C||!y(C))return f;for(var q=Object.keys(C),nt=q.length;nt--;)f[q[nt]]=C[q[nt]];return f}}},G={};function U(F){var u=G[F];if(u!==void 0)return u.exports;var j=G[F]={exports:{}};return W[F].call(j.exports,j,j.exports,U),j.exports}U.n=F=>{var u=F&&F.__esModule?()=>F.default:()=>F;return U.d(u,{a:u}),u},U.d=(F,u)=>{for(var j in u)U.o(u,j)&&!U.o(F,j)&&Object.defineProperty(F,j,{enumerable:!0,get:u[j]})},U.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),U.o=(F,u)=>Object.prototype.hasOwnProperty.call(F,u),U.r=F=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(F,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(F,"__esModule",{value:!0})};var ut={};return(()=>{"use strict";U.r(ut),U.d(ut,{LSPluginUser:()=>Wn,setupPluginUserInstance:()=>yr});var F=U(520),u=(U(856),U(996)),j=U.n(u),v=function(){return v=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},v.apply(this,arguments)};function d(e){return e.toLowerCase()}var A=[/([a-z0-9])([A-Z])/g,/([A-Z])([A-Z][a-z])/g],J=/[^A-Z0-9]+/gi;function w(e,t,n){return t instanceof RegExp?e.replace(t,n):t.reduce(function(r,s){return r.replace(s,n)},e)}function h(e,t){return t===void 0&&(t={}),function(n,r){r===void 0&&(r={});for(var s=r.splitRegexp,a=s===void 0?A:s,c=r.stripRegexp,m=c===void 0?J:c,O=r.transform,P=O===void 0?d:O,Z=r.delimiter,D=Z===void 0?" ":Z,z=w(w(n,a,"$1\0$2"),m,"\0"),K=0,V=z.length;z.charAt(K)==="\0";)K++;for(;z.charAt(V-1)==="\0";)V--;return z.slice(K,V).split("\0").map(P).join(D)}(e,v({delimiter:"."},t))}var k=U(729),p=U.n(k);function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let b=navigator.platform.toLowerCase()==="win32"?F.win32:F.posix,x=function(e,t){return t===void 0&&(t={}),h(e,v({delimiter:"_"},t))};class R extends p(){constructor(t,n){super(),_(this,"_tag",void 0),_(this,"_opts",void 0),_(this,"_logs",[]),this._tag=t,this._opts=n}write(t,n,r){var s;n!=null&&n.length&&n[n.length-1]===!0&&(r=!0,n.pop());let a=n.reduce((m,O)=>(O&&O instanceof Error?m+=`${O.message} ${O.stack}`:m+=O.toString(),m),`[${this._tag}][${new Date().toLocaleTimeString()}] `);var c;this._logs.push([t,a]),(r||(s=this._opts)!==null&&s!==void 0&&s.console)&&((c=console)===null||c===void 0||c[t==="ERROR"?"error":"debug"](`${t}: ${a}`)),this.emit("change")}clear(){this._logs=[],this.emit("change")}info(...t){this.write("INFO",t)}error(...t){this.write("ERROR",t)}warn(...t){this.write("WARN",t)}setTag(t){this._tag=t}toJSON(){return this._logs}}function T(e,...t){try{let n=new URL(e);if(!n.origin)throw new Error(null);let r=b.join(e.substr(n.origin.length),...t);return n.origin+r}catch{return b.join(e,...t)}}function M(e,t){let n,r,s=!1,a=m=>O=>{e&&clearTimeout(e),m(O),s=!0},c=new Promise((m,O)=>{n=a(m),r=a(O),e&&(e=setTimeout(()=>r(new Error(`[deferred timeout] ${t}`)),e))});return{created:Date.now(),setTag:m=>t=m,resolve:n,reject:r,promise:c,get settled(){return s}}}let i=new Map;window.__injectedUIEffects=i;var l=U(227),g=U.n(l);function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let B="application/x-postmate-v1+json",tt=0,et={handshake:1,"handshake-reply":1,call:1,emit:1,reply:1,request:1},at=(e,t)=>(typeof t!="string"||e.origin===t)&&!!e.data&&(typeof e.data!="object"||"postmate"in e.data)&&e.data.type===B&&!!et[e.data.postmate];class ht{constructor(t){y(this,"parent",void 0),y(this,"frame",void 0),y(this,"child",void 0),y(this,"events",{}),y(this,"childOrigin",void 0),y(this,"listener",void 0),this.parent=t.parent,this.frame=t.frame,this.child=t.child,this.childOrigin=t.childOrigin,this.listener=n=>{if(!at(n,this.childOrigin))return!1;let{data:r,name:s}=((n||{}).data||{}).value||{};n.data.postmate==="emit"&&s in this.events&&this.events[s].forEach(a=>{a.call(this,r)})},this.parent.addEventListener("message",this.listener,!1)}get(t,...n){return new Promise((r,s)=>{let a=++tt,c=m=>{m.data.uid===a&&m.data.postmate==="reply"&&(this.parent.removeEventListener("message",c,!1),m.data.error?s(m.data.error):r(m.data.value))};this.parent.addEventListener("message",c,!1),this.child.postMessage({postmate:"request",type:B,property:t,args:n,uid:a},this.childOrigin)})}call(t,n){this.child.postMessage({postmate:"call",type:B,property:t,data:n},this.childOrigin)}on(t,n){this.events[t]||(this.events[t]=[]),this.events[t].push(n)}destroy(){window.removeEventListener("message",this.listener,!1),this.frame.parentNode.removeChild(this.frame)}}class mt{constructor(t){y(this,"model",void 0),y(this,"parent",void 0),y(this,"parentOrigin",void 0),y(this,"child",void 0),this.model=t.model,this.parent=t.parent,this.parentOrigin=t.parentOrigin,this.child=t.child,this.child.addEventListener("message",n=>{if(!at(n,this.parentOrigin))return;let{property:r,uid:s,data:a,args:c}=n.data;n.data.postmate!=="call"?((m,O,P)=>{let Z=typeof m[O]=="function"?m[O].apply(null,P):m[O];return Promise.resolve(Z)})(this.model,r,c).then(m=>{n.source.postMessage({property:r,postmate:"reply",type:B,uid:s,value:m},n.origin)}).catch(m=>{n.source.postMessage({property:r,postmate:"reply",type:B,uid:s,error:m},n.origin)}):r in this.model&&typeof this.model[r]=="function"&&this.model[r](a)})}emit(t,n){this.parent.postMessage({postmate:"emit",type:B,value:{name:t,data:n}},this.parentOrigin)}}class ${constructor(t){y(this,"container",void 0),y(this,"parent",void 0),y(this,"frame",void 0),y(this,"child",void 0),y(this,"childOrigin",void 0),y(this,"url",void 0),y(this,"model",void 0),this.container=t.container,this.url=t.url,this.parent=window,this.frame=document.createElement("iframe"),t.id&&(this.frame.id=t.id),t.name&&(this.frame.name=t.name),this.frame.classList.add.apply(this.frame.classList,t.classListArray||[]),this.container.appendChild(this.frame),this.child=this.frame.contentWindow,this.model=t.model||{}}sendHandshake(t){let n=(a=>{let c=document.createElement("a");c.href=a;let m=c.protocol.length>4?c.protocol:window.location.protocol,O=c.host.length?c.port==="80"||c.port==="443"?c.hostname:c.host:window.location.host;return c.origin||`${m}//${O}`})(t=t||this.url),r,s=0;return new Promise((a,c)=>{let m=P=>!!at(P,n)&&(P.data.postmate==="handshake-reply"?(clearInterval(r),this.parent.removeEventListener("message",m,!1),this.childOrigin=P.origin,a(new ht(this))):c("Failed handshake"));this.parent.addEventListener("message",m,!1);let O=()=>{s++,this.child.postMessage({postmate:"handshake",type:B,model:this.model},n),s===5&&clearInterval(r)};this.frame.addEventListener("load",()=>{O(),r=setInterval(O,500)}),this.frame.src=t})}destroy(){this.frame.parentNode.removeChild(this.frame)}}y($,"debug",!1),y($,"Model",void 0);class xt{constructor(t){y(this,"child",void 0),y(this,"model",void 0),y(this,"parent",void 0),y(this,"parentOrigin",void 0),this.child=window,this.model=t,this.parent=this.child.parent}sendHandshakeReply(){return new Promise((t,n)=>{let r=s=>{if(s.data.postmate){if(s.data.postmate==="handshake"){this.child.removeEventListener("message",r,!1),s.source.postMessage({postmate:"handshake-reply",type:B},s.origin),this.parentOrigin=s.origin;let a=s.data.model;return a&&Object.keys(a).forEach(c=>{this.model[c]=a[c]}),t(new mt(this))}return n("Handshake Reply Failed")}};this.child.addEventListener("message",r,!1)})}}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let{importHTML:C,createSandboxContainer:q}=window.QSandbox||{};function nt(e,t){return e.startsWith("http")?fetch(e,t):(e=e.replace("file://",""),new Promise(async(n,r)=>{try{let s=await window.apis.doAction(["readFile",e]);n({text:()=>s})}catch(s){console.error(s),r(s)}}))}class kt extends p(){constructor(t){super(),f(this,"_pluginLocal",void 0),f(this,"_frame",void 0),f(this,"_root",void 0),f(this,"_loaded",!1),f(this,"_unmountFns",[]),this._pluginLocal=t,t._dispose(()=>{this._unmount()})}async load(){let{name:t,entry:n}=this._pluginLocal.options;if(this.loaded||!n)return;let{template:r,execScripts:s}=await C(n,{fetch:nt});this._mount(r,document.body);let a=q(t,{elementGetter:()=>{var m;return(m=this._root)===null||m===void 0?void 0:m.firstChild}}).instance.proxy;a.__shadow_mode__=!0,a.LSPluginLocal=this._pluginLocal,a.LSPluginShadow=this,a.LSPluginUser=a.logseq=new Wn(this._pluginLocal.toJSON(),this._pluginLocal.caller);let c=await s(a,!0);this._unmountFns.push(c.unmount),this._loaded=!0}_mount(t,n){let r=this._frame=document.createElement("div");r.classList.add("lsp-shadow-sandbox"),r.id=this._pluginLocal.id,this._root=r.attachShadow({mode:"open"}),this._root.innerHTML=`<div>${t}</div>`,n.appendChild(r),this.emit("mounted")}_unmount(){for(let t of this._unmountFns)t&&t.call(null)}destroy(){var t,n;(t=this.frame)===null||t===void 0||(n=t.parentNode)===null||n===void 0||n.removeChild(this.frame)}get loaded(){return this._loaded}get document(){var t;return(t=this._root)===null||t===void 0?void 0:t.firstChild}get frame(){return this._frame}}function N(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let Y=g()("LSPlugin:caller"),it="#await#response#",Et="#lspmsg#",wt="#lspmsg#error#",Mt=e=>`#lspmsg#${e}`;class ee extends p(){constructor(t){super(),N(this,"_pluginLocal",void 0),N(this,"_connected",!1),N(this,"_parent",void 0),N(this,"_child",void 0),N(this,"_shadow",void 0),N(this,"_status",void 0),N(this,"_userModel",{}),N(this,"_call",void 0),N(this,"_callUserModel",void 0),N(this,"_debugTag",""),this._pluginLocal=t,t&&(this._debugTag=t.debugTag)}async connectToChild(){if(this._connected)return;let{shadow:t}=this._pluginLocal;t?await this._setupShadowSandbox():await this._setupIframeSandbox()}async connectToParent(t={}){if(this._connected)return;let n=this,r=this._pluginLocal!=null,s=0,a=0,c=new Map,m=M(6e4),O=this._extendUserModel({"#lspmsg#ready#":async D=>{O[Mt(D?.pid)]=({type:z,payload:K})=>{Y(`[host (_call) -> *user] ${this._debugTag}`,z,K),n.emit(z,K)},await m.resolve()},"#lspmsg#beforeunload#":async D=>{let z=M(1e4);n.emit("beforeunload",Object.assign({actor:z},D)),await z.promise},"#lspmsg#settings#":async({type:D,payload:z})=>{n.emit("settings:changed",z)},[Et]:async({ns:D,type:z,payload:K})=>{Y(`[host (async) -> *user] ${this._debugTag} ns=${D} type=${z}`,K),D&&D.startsWith("hook")?n.emit(`${D}:${z}`,K):n.emit(z,K)},"#lspmsg#reply#":({_sync:D,result:z})=>{if(Y(`[sync host -> *user] #${D}`,z),c.has(D)){let K=c.get(D);K&&(z!=null&&z.hasOwnProperty(wt)?K.reject(z[wt]):K.resolve(z),c.delete(D))}},...t});var P;if(r)return await m.promise,JSON.parse(JSON.stringify((P=this._pluginLocal)===null||P===void 0?void 0:P.toJSON()));let Z=new xt(O).sendHandshakeReply();return this._status="pending",await Z.then(D=>{this._child=D,this._connected=!0,this._call=async(z,K={},V)=>{if(V){let Q=++a;c.set(Q,V),K._sync=Q,V.setTag(`async call #${Q}`),Y(`async call #${Q}`)}return D.emit(Mt(O.baseInfo.id),{type:z,payload:K}),V?.promise},this._callUserModel=async(z,K)=>{try{O[z](K)}catch{Y(`[model method] #${z} not existed`)}},s=setInterval(()=>{if(c.size>100)for(let[z,K]of c)K.settled&&c.delete(z)},18e5)}).finally(()=>{this._status=void 0}),await m.promise,O.baseInfo}async call(t,n={}){var r;return(r=this._call)===null||r===void 0?void 0:r.call(this,t,n)}async callAsync(t,n={}){var r;let s=M(1e4);return(r=this._call)===null||r===void 0?void 0:r.call(this,t,n,s)}async callUserModel(t,...n){var r;return(r=this._callUserModel)===null||r===void 0?void 0:r.apply(this,[t,...n])}async callUserModelAsync(t,...n){var r;return t=`${it}${t}`,(r=this._callUserModel)===null||r===void 0?void 0:r.apply(this,[t,...n])}async _setupIframeSandbox(){let t=this._pluginLocal,n=t.id,r=`${n}_lsp_main`,s=new URL(t.options.entry);s.searchParams.set("__v__",t.options.version);let a=document.querySelector(`#${r}`);a&&a.parentElement.removeChild(a);let c=document.createElement("div");c.classList.add("lsp-iframe-sandbox-container"),c.id=r,c.dataset.pid=n;try{var m;let D=(m=await this._pluginLocal._loadLayoutsData())===null||m===void 0?void 0:m.$$0;if(D){c.dataset.inited_layout="true";let{width:z,height:K,left:V,top:Q,vw:st,vh:bt}=D;V=Math.max(V,0),V=typeof st=="number"?`${Math.min(100*V/st,99)}%`:`${V}px`,Q=Math.max(Q,45),Q=typeof bt=="number"?`${Math.min(100*Q/bt,99)}%`:`${Q}px`,Object.assign(c.style,{width:z+"px",height:K+"px",left:V,top:Q})}}catch(D){console.error("[Restore Layout Error]",D)}document.body.appendChild(c);let O=new $({id:n+"_iframe",container:c,url:s.href,classListArray:["lsp-iframe-sandbox"],model:{baseInfo:JSON.parse(JSON.stringify(t.toJSON()))}}),P,Z=O.sendHandshake();return this._status="pending",new Promise((D,z)=>{P=setTimeout(()=>{z(new Error("handshake Timeout")),O.destroy()},4e3),Z.then(K=>{this._parent=K,this._connected=!0,this.emit("connected"),K.on(Mt(t.id),({type:V,payload:Q})=>{var st,bt;Y("[user -> *host] ",V,Q),(st=this._pluginLocal)===null||st===void 0||st.emit(V,Q||{}),(bt=this._pluginLocal)===null||bt===void 0||bt.caller.emit(V,Q||{})}),this._call=async(...V)=>{await K.call(Mt(t.id),{type:V[0],payload:Object.assign(V[1]||{},{$$pid:t.id})})},this._callUserModel=async(V,...Q)=>{if(V.startsWith(it))return await K.get(V.replace(it,""),...Q);K.call(V,Q?.[0])},D(null)}).catch(K=>{z(K)}).finally(()=>{clearTimeout(P)})}).catch(D=>{throw Y("[iframe sandbox] error",D),D}).finally(()=>{this._status=void 0})}async _setupShadowSandbox(){let t=this._pluginLocal,n=this._shadow=new kt(t);try{this._status="pending",await n.load(),this._connected=!0,this.emit("connected"),this._call=async(r,s={},a)=>{var c;return a&&(s.actor=a),(c=this._pluginLocal)===null||c===void 0||c.emit(r,Object.assign(s,{$$pid:t.id})),a?.promise},this._callUserModel=async(...r)=>{var s;let a=r[0];(s=a)!==null&&s!==void 0&&s.startsWith(it)&&(a=a.replace(it,""));let c=r[1]||{},m=this._userModel[a];typeof m=="function"&&await m.call(null,c)}}catch(r){throw Y("[shadow sandbox] error",r),r}finally{this._status=void 0}}_extendUserModel(t){return Object.assign(this._userModel,t)}_getSandboxIframeContainer(){var t;return(t=this._parent)===null||t===void 0?void 0:t.frame.parentNode}_getSandboxShadowContainer(){var t;return(t=this._shadow)===null||t===void 0?void 0:t.frame.parentNode}_getSandboxIframeRoot(){var t;return(t=this._parent)===null||t===void 0?void 0:t.frame}_getSandboxShadowRoot(){var t;return(t=this._shadow)===null||t===void 0?void 0:t.frame}set debugTag(t){this._debugTag=t}async destroy(){var t;let n=null;this._parent&&(n=this._getSandboxIframeContainer(),await this._parent.destroy()),this._shadow&&(n=this._getSandboxShadowContainer(),this._shadow.destroy()),(t=n)===null||t===void 0||t.parentNode.removeChild(n)}}function dt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class lt{constructor(t,n){dt(this,"ctx",void 0),dt(this,"opts",void 0),this.ctx=t,this.opts=n}get ctxId(){return this.ctx.baseInfo.id}setItem(t,n){var r;return this.ctx.caller.callAsync("api:call",{method:"write-plugin-storage-file",args:[this.ctxId,t,n,(r=this.opts)===null||r===void 0?void 0:r.assets]})}getItem(t){var n;return this.ctx.caller.callAsync("api:call",{method:"read-plugin-storage-file",args:[this.ctxId,t,(n=this.opts)===null||n===void 0?void 0:n.assets]})}removeItem(t){var n;return this.ctx.caller.call("api:call",{method:"unlink-plugin-storage-file",args:[this.ctxId,t,(n=this.opts)===null||n===void 0?void 0:n.assets]})}allKeys(){var t;return this.ctx.caller.callAsync("api:call",{method:"list-plugin-storage-files",args:[this.ctxId,(t=this.opts)===null||t===void 0?void 0:t.assets]})}clear(){var t;return this.ctx.caller.call("api:call",{method:"clear-plugin-storage-files",args:[this.ctxId,(t=this.opts)===null||t===void 0?void 0:t.assets]})}hasItem(t){var n;return this.ctx.caller.callAsync("api:call",{method:"exist-plugin-storage-file",args:[this.ctxId,t,(n=this.opts)===null||n===void 0?void 0:n.assets]})}}class Ct{constructor(t){var n,r,s;s=void 0,(r="ctx")in(n=this)?Object.defineProperty(n,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[r]=s,this.ctx=t}get React(){return this.ensureHostScope().React}get ReactDOM(){return this.ensureHostScope().ReactDOM}get pluginLocal(){return this.ensureHostScope().LSPluginCore.ensurePlugin(this.ctx.baseInfo.id)}invokeExperMethod(t,...n){var r,s;let a=this.ensureHostScope();return t=(r=x(t))===null||r===void 0?void 0:r.toLowerCase(),(s=a.logseq.api["exper_"+t])===null||s===void 0?void 0:s.apply(a,n)}async loadScripts(...t){(t=t.map(n=>n!=null&&n.startsWith("http")?n:this.ctx.resolveResourceFullUrl(n))).unshift(this.ctx.baseInfo.id),await this.invokeExperMethod("loadScripts",...t)}registerFencedCodeRenderer(t,n){return this.ensureHostScope().logseq.api.exper_register_fenced_code_renderer(this.ctx.baseInfo.id,t,n)}registerExtensionsEnhancer(t,n){let r=this.ensureHostScope();return t==="katex"&&r.katex&&n(r.katex).catch(console.error),r.logseq.api.exper_register_extensions_enhancer(this.ctx.baseInfo.id,t,n)}ensureHostScope(){if(window===top)throw new Error("Can not access host scope!");return top}}function Ot(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let $t=e=>`task_callback_${e}`;class Yt{constructor(t,n,r={}){Ot(this,"_client",void 0),Ot(this,"_requestId",void 0),Ot(this,"_requestOptions",void 0),Ot(this,"_promise",void 0),Ot(this,"_aborted",!1),this._client=t,this._requestId=n,this._requestOptions=r,this._promise=new Promise((m,O)=>{if(!this._requestId)return O(null);this._client.once($t(this._requestId),P=>{P&&P instanceof Error?O(P):m(P)})});let{success:s,fail:a,final:c}=this._requestOptions;this._promise.then(m=>{s?.(m)}).catch(m=>{a?.(m)}).finally(()=>{c?.()})}abort(){this._requestOptions.abortable&&!this._aborted&&(this._client.ctx._execCallableAPI("http_request_abort",this._requestId),this._aborted=!0)}get promise(){return this._promise}get client(){return this._client}get requestId(){return this._requestId}}class Lt extends k.EventEmitter{constructor(t){super(),Ot(this,"_ctx",void 0),this._ctx=t,this.ctx.caller.on("#lsp#request#callback",n=>{let r=n?.requestId;r&&this.emit($t(r),n?.payload)})}static createRequestTask(t,n,r){return new Yt(t,n,r)}async _request(t){let n=this.ctx.baseInfo.id,{success:r,fail:s,final:a,...c}=t,m=this.ctx.Experiments.invokeExperMethod("request",n,c),O=Lt.createRequestTask(this.ctx.Request,m,t);return c.abortable?O:O.promise}get ctx(){return this._ctx}}let At=Array.isArray,fe=typeof global=="object"&&global&&global.Object===Object&&global;var wn=typeof self=="object"&&self&&self.Object===Object&&self;let Nt=fe||wn||Function("return this")(),Wt=Nt.Symbol;var Ye=Object.prototype,xn=Ye.hasOwnProperty,kn=Ye.toString,he=Wt?Wt.toStringTag:void 0;let Cn=function(e){var t=xn.call(e,he),n=e[he];try{e[he]=void 0;var r=!0}catch{}var s=kn.call(e);return r&&(t?e[he]=n:delete e[he]),s};var Ze=Object.prototype.toString;let E=function(e){return Ze.call(e)};var I=Wt?Wt.toStringTag:void 0;let H=function(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":I&&I in Object(e)?Cn(e):E(e)},X=function(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")},ft=function(e){if(!X(e))return!1;var t=H(e);return t=="[object Function]"||t=="[object GeneratorFunction]"||t=="[object AsyncFunction]"||t=="[object Proxy]"},Pt=Nt["__core-js_shared__"];var Gt,ne=(Gt=/[^.]+$/.exec(Pt&&Pt.keys&&Pt.keys.IE_PROTO||""))?"Symbol(src)_1."+Gt:"";let $e=function(e){return!!ne&&ne in e};var Xe=Function.prototype.toString;let Zt=function(e){if(e!=null){try{return Xe.call(e)}catch{}try{return e+""}catch{}}return""};var Sn=/^\[object .+?Constructor\]$/,En=Function.prototype,On=Object.prototype,Se=En.toString,An=On.hasOwnProperty,jn=RegExp("^"+Se.call(An).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");let Mn=function(e){return!(!X(e)||$e(e))&&(ft(e)?jn:Sn).test(Zt(e))},Ne=function(e,t){return e?.[t]},Rt=function(e,t){var n=Ne(e,t);return Mn(n)?n:void 0},Dt=function(){try{var e=Rt(Object,"defineProperty");return e({},"",{}),e}catch{}}(),Qe=function(e,t,n){t=="__proto__"&&Dt?Dt(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},Ee=function(e){return function(t,n,r){for(var s=-1,a=Object(t),c=r(t),m=c.length;m--;){var O=c[e?m:++s];if(n(a[O],O,a)===!1)break}return t}}(),Pe=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r},re=function(e){return e!=null&&typeof e=="object"},tn=function(e){return re(e)&&H(e)=="[object Arguments]"};var en=Object.prototype,Ln=en.hasOwnProperty,nn=en.propertyIsEnumerable;let Tt=tn(function(){return arguments}())?tn:function(e){return re(e)&&Ln.call(e,"callee")&&!nn.call(e,"callee")},me=function(){return!1};var Jt=typeof Ft=="object"&&Ft&&!Ft.nodeType&&Ft,Oe=Jt&&typeof Bt=="object"&&Bt&&!Bt.nodeType&&Bt,Ae=Oe&&Oe.exports===Jt?Nt.Buffer:void 0;let Re=(Ae?Ae.isBuffer:void 0)||me;var Tn=/^(?:0|[1-9]\d*)$/;let rn=function(e,t){var n=typeof e;return!!(t=t??9007199254740991)&&(n=="number"||n!="symbol"&&Tn.test(e))&&e>-1&&e%1==0&&e<t},je=function(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=9007199254740991};var rt={};rt["[object Float32Array]"]=rt["[object Float64Array]"]=rt["[object Int8Array]"]=rt["[object Int16Array]"]=rt["[object Int32Array]"]=rt["[object Uint8Array]"]=rt["[object Uint8ClampedArray]"]=rt["[object Uint16Array]"]=rt["[object Uint32Array]"]=!0,rt["[object Arguments]"]=rt["[object Array]"]=rt["[object ArrayBuffer]"]=rt["[object Boolean]"]=rt["[object DataView]"]=rt["[object Date]"]=rt["[object Error]"]=rt["[object Function]"]=rt["[object Map]"]=rt["[object Number]"]=rt["[object Object]"]=rt["[object RegExp]"]=rt["[object Set]"]=rt["[object String]"]=rt["[object WeakMap]"]=!1;let gt=function(e){return re(e)&&je(e.length)&&!!rt[H(e)]},on=function(e){return function(t){return e(t)}};var yt=typeof Ft=="object"&&Ft&&!Ft.nodeType&&Ft,oe=yt&&typeof Bt=="object"&&Bt&&!Bt.nodeType&&Bt,ct=oe&&oe.exports===yt&&fe.process,ie=function(){try{var e=oe&&oe.require&&oe.require("util").types;return e||ct&&ct.binding&&ct.binding("util")}catch{}}(),Me=ie&&ie.isTypedArray;let De=Me?on(Me):gt;var Ue=Object.prototype.hasOwnProperty;let sn=function(e,t){var n=At(e),r=!n&&Tt(e),s=!n&&!r&&Re(e),a=!n&&!r&&!s&&De(e),c=n||r||s||a,m=c?Pe(e.length,String):[],O=m.length;for(var P in e)!t&&!Ue.call(e,P)||c&&(P=="length"||s&&(P=="offset"||P=="parent")||a&&(P=="buffer"||P=="byteLength"||P=="byteOffset")||rn(P,O))||m.push(P);return m};var se=Object.prototype;let Xt=function(e){var t=e&&e.constructor;return e===(typeof t=="function"&&t.prototype||se)},qe=function(e,t){return function(n){return e(t(n))}}(Object.keys,Object);var ze=Object.prototype.hasOwnProperty;let ae=function(e){if(!Xt(e))return qe(e);var t=[];for(var n in Object(e))ze.call(e,n)&&n!="constructor"&&t.push(n);return t},Le=function(e){return e!=null&&je(e.length)&&!ft(e)},le=function(e){return Le(e)?sn(e):ae(e)},an=function(e,t){return e&&Ee(e,t,le)},He=function(){this.__data__=[],this.size=0},ce=function(e,t){return e===t||e!=e&&t!=t},Ut=function(e,t){for(var n=e.length;n--;)if(ce(e[n][0],t))return n;return-1};var ue=Array.prototype.splice;let ln=function(e){var t=this.__data__,n=Ut(t,e);return!(n<0)&&(n==t.length-1?t.pop():ue.call(t,n,1),--this.size,!0)},cn=function(e){var t=this.__data__,n=Ut(t,e);return n<0?void 0:t[n][1]},un=function(e){return Ut(this.__data__,e)>-1},Be=function(e,t){var n=this.__data__,r=Ut(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};function Qt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Qt.prototype.clear=He,Qt.prototype.delete=ln,Qt.prototype.get=cn,Qt.prototype.has=un,Qt.prototype.set=Be;let de=Qt,We=function(){this.__data__=new de,this.size=0},Kt=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Te=function(e){return this.__data__.get(e)},dn=function(e){return this.__data__.has(e)},ge=Rt(Nt,"Map"),ye=Rt(Object,"create"),pe=function(){this.__data__=ye?ye(null):{},this.size=0},In=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var pn=Object.prototype.hasOwnProperty;let Ge=function(e){var t=this.__data__;if(ye){var n=t[e];return n==="__lodash_hash_undefined__"?void 0:n}return pn.call(t,e)?t[e]:void 0};var fn=Object.prototype.hasOwnProperty;let hn=function(e){var t=this.__data__;return ye?t[e]!==void 0:fn.call(t,e)},Fn=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ye&&t===void 0?"__lodash_hash_undefined__":t,this};function qt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}qt.prototype.clear=pe,qt.prototype.delete=In,qt.prototype.get=Ge,qt.prototype.has=hn,qt.prototype.set=Fn;let Ie=qt,$n=function(){this.size=0,this.__data__={hash:new Ie,map:new(ge||de),string:new Ie}},zt=function(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null},ve=function(e,t){var n=e.__data__;return zt(t)?n[typeof t=="string"?"string":"hash"]:n.map},mn=function(e){var t=ve(this,e).delete(e);return this.size-=t?1:0,t},gn=function(e){return ve(this,e).get(e)},Nn=function(e){return ve(this,e).has(e)},be=function(e,t){var n=ve(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function St(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}St.prototype.clear=$n,St.prototype.delete=mn,St.prototype.get=gn,St.prototype.has=Nn,St.prototype.set=be;let _e=St,yn=function(e,t){var n=this.__data__;if(n instanceof de){var r=n.__data__;if(!ge||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new _e(r)}return n.set(e,t),this.size=n.size,this};function te(e){var t=this.__data__=new de(e);this.size=t.size}te.prototype.clear=We,te.prototype.delete=Kt,te.prototype.get=Te,te.prototype.has=dn,te.prototype.set=yn;let we=te,Pn=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},o=function(e){return this.__data__.has(e)};function L(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new _e;++t<n;)this.add(e[t])}L.prototype.add=L.prototype.push=Pn,L.prototype.has=o;let S=L,ot=function(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1},pt=function(e,t){return e.has(t)},_t=function(e,t,n,r,s,a){var c=1&n,m=e.length,O=t.length;if(m!=O&&!(c&&O>m))return!1;var P=a.get(e),Z=a.get(t);if(P&&Z)return P==t&&Z==e;var D=-1,z=!0,K=2&n?new S:void 0;for(a.set(e,t),a.set(t,e);++D<m;){var V=e[D],Q=t[D];if(r)var st=c?r(Q,V,D,t,e,a):r(V,Q,D,e,t,a);if(st!==void 0){if(st)continue;z=!1;break}if(K){if(!ot(t,function(bt,It){if(!pt(K,It)&&(V===bt||s(V,bt,n,r,a)))return K.push(It)})){z=!1;break}}else if(V!==Q&&!s(V,Q,n,r,a)){z=!1;break}}return a.delete(e),a.delete(t),z},vt=Nt.Uint8Array,xe=function(e){var t=-1,n=Array(e.size);return e.forEach(function(r,s){n[++t]=[s,r]}),n},Vt=function(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n};var jt=Wt?Wt.prototype:void 0,Je=jt?jt.valueOf:void 0;let Jn=function(e,t,n,r,s,a,c){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new vt(e),new vt(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return ce(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var m=xe;case"[object Set]":var O=1&r;if(m||(m=Vt),e.size!=t.size&&!O)return!1;var P=c.get(e);if(P)return P==t;r|=2,c.set(e,t);var Z=_t(m(e),m(t),r,s,a,c);return c.delete(e),Z;case"[object Symbol]":if(Je)return Je.call(e)==Je.call(t)}return!1},Cr=function(e,t){for(var n=-1,r=t.length,s=e.length;++n<r;)e[s+n]=t[n];return e},Sr=function(e,t,n){var r=t(e);return At(e)?r:Cr(r,n(e))},Er=function(e,t){for(var n=-1,r=e==null?0:e.length,s=0,a=[];++n<r;){var c=e[n];t(c,n,e)&&(a[s++]=c)}return a},Or=function(){return[]};var Ar=Object.prototype.propertyIsEnumerable,Kn=Object.getOwnPropertySymbols;let jr=Kn?function(e){return e==null?[]:(e=Object(e),Er(Kn(e),function(t){return Ar.call(e,t)}))}:Or,Vn=function(e){return Sr(e,le,jr)};var Mr=Object.prototype.hasOwnProperty;let Lr=function(e,t,n,r,s,a){var c=1&n,m=Vn(e),O=m.length;if(O!=Vn(t).length&&!c)return!1;for(var P=O;P--;){var Z=m[P];if(!(c?Z in t:Mr.call(t,Z)))return!1}var D=a.get(e),z=a.get(t);if(D&&z)return D==t&&z==e;var K=!0;a.set(e,t),a.set(t,e);for(var V=c;++P<O;){var Q=e[Z=m[P]],st=t[Z];if(r)var bt=c?r(st,Q,Z,t,e,a):r(Q,st,Z,e,t,a);if(!(bt===void 0?Q===st||s(Q,st,n,r,a):bt)){K=!1;break}V||(V=Z=="constructor")}if(K&&!V){var It=e.constructor,Ce=t.constructor;It==Ce||!("constructor"in e)||!("constructor"in t)||typeof It=="function"&&It instanceof It&&typeof Ce=="function"&&Ce instanceof Ce||(K=!1)}return a.delete(e),a.delete(t),K},Rn=Rt(Nt,"DataView"),Dn=Rt(Nt,"Promise"),Un=Rt(Nt,"Set"),qn=Rt(Nt,"WeakMap");var Yn="[object Map]",Zn="[object Promise]",Xn="[object Set]",Qn="[object WeakMap]",tr="[object DataView]",Tr=Zt(Rn),Ir=Zt(ge),Fr=Zt(Dn),$r=Zt(Un),Nr=Zt(qn),ke=H;(Rn&&ke(new Rn(new ArrayBuffer(1)))!=tr||ge&&ke(new ge)!=Yn||Dn&&ke(Dn.resolve())!=Zn||Un&&ke(new Un)!=Xn||qn&&ke(new qn)!=Qn)&&(ke=function(e){var t=H(e),n=t=="[object Object]"?e.constructor:void 0,r=n?Zt(n):"";if(r)switch(r){case Tr:return tr;case Ir:return Yn;case Fr:return Zn;case $r:return Xn;case Nr:return Qn}return t});let er=ke;var nr="[object Arguments]",rr="[object Array]",vn="[object Object]",or=Object.prototype.hasOwnProperty;let Pr=function(e,t,n,r,s,a){var c=At(e),m=At(t),O=c?rr:er(e),P=m?rr:er(t),Z=(O=O==nr?vn:O)==vn,D=(P=P==nr?vn:P)==vn,z=O==P;if(z&&Re(e)){if(!Re(t))return!1;c=!0,Z=!1}if(z&&!Z)return a||(a=new we),c||De(e)?_t(e,t,n,r,s,a):Jn(e,t,O,n,r,s,a);if(!(1&n)){var K=Z&&or.call(e,"__wrapped__"),V=D&&or.call(t,"__wrapped__");if(K||V){var Q=K?e.value():e,st=V?t.value():t;return a||(a=new we),s(Q,st,n,r,a)}}return!!z&&(a||(a=new we),Lr(e,t,n,r,s,a))},ir=function e(t,n,r,s,a){return t===n||(t==null||n==null||!re(t)&&!re(n)?t!=t&&n!=n:Pr(t,n,r,s,e,a))},Rr=function(e,t,n,r){var s=n.length,a=s,c=!r;if(e==null)return!a;for(e=Object(e);s--;){var m=n[s];if(c&&m[2]?m[1]!==e[m[0]]:!(m[0]in e))return!1}for(;++s<a;){var O=(m=n[s])[0],P=e[O],Z=m[1];if(c&&m[2]){if(P===void 0&&!(O in e))return!1}else{var D=new we;if(r)var z=r(P,Z,O,e,t,D);if(!(z===void 0?ir(Z,P,3,r,D):z))return!1}}return!0},sr=function(e){return e==e&&!X(e)},Dr=function(e){for(var t=le(e),n=t.length;n--;){var r=t[n],s=e[r];t[n]=[r,s,sr(s)]}return t},ar=function(e,t){return function(n){return n!=null&&n[e]===t&&(t!==void 0||e in Object(n))}},Ur=function(e){var t=Dr(e);return t.length==1&&t[0][2]?ar(t[0][0],t[0][1]):function(n){return n===e||Rr(n,e,t)}},zn=function(e){return typeof e=="symbol"||re(e)&&H(e)=="[object Symbol]"};var qr=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,zr=/^\w*$/;let Hn=function(e,t){if(At(e))return!1;var n=typeof e;return!(n!="number"&&n!="symbol"&&n!="boolean"&&e!=null&&!zn(e))||zr.test(e)||!qr.test(e)||t!=null&&e in Object(t)};function Bn(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError("Expected a function");var n=function(){var r=arguments,s=t?t.apply(this,r):r[0],a=n.cache;if(a.has(s))return a.get(s);var c=e.apply(this,r);return n.cache=a.set(s,c)||a,c};return n.cache=new(Bn.Cache||_e),n}Bn.Cache=_e;let Hr=Bn;var Br=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Wr=/\\(\\)?/g;let Gr=function(e){var t=Hr(e,function(r){return n.size===500&&n.clear(),r}),n=t.cache;return t}(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Br,function(n,r,s,a){t.push(s?a.replace(Wr,"$1"):r||n)}),t}),Jr=function(e,t){for(var n=-1,r=e==null?0:e.length,s=Array(r);++n<r;)s[n]=t(e[n],n,e);return s};var lr=Wt?Wt.prototype:void 0,cr=lr?lr.toString:void 0;let Kr=function e(t){if(typeof t=="string")return t;if(At(t))return Jr(t,e)+"";if(zn(t))return cr?cr.call(t):"";var n=t+"";return n=="0"&&1/t==-1/0?"-0":n},Vr=function(e){return e==null?"":Kr(e)},ur=function(e,t){return At(e)?e:Hn(e,t)?[e]:Gr(Vr(e))},bn=function(e){if(typeof e=="string"||zn(e))return e;var t=e+"";return t=="0"&&1/e==-1/0?"-0":t},dr=function(e,t){for(var n=0,r=(t=ur(t,e)).length;e!=null&&n<r;)e=e[bn(t[n++])];return n&&n==r?e:void 0},Yr=function(e,t,n){var r=e==null?void 0:dr(e,t);return r===void 0?n:r},Zr=function(e,t){return e!=null&&t in Object(e)},Xr=function(e,t,n){for(var r=-1,s=(t=ur(t,e)).length,a=!1;++r<s;){var c=bn(t[r]);if(!(a=e!=null&&n(e,c)))break;e=e[c]}return a||++r!=s?a:!!(s=e==null?0:e.length)&&je(s)&&rn(c,s)&&(At(e)||Tt(e))},Qr=function(e,t){return e!=null&&Xr(e,t,Zr)},to=function(e,t){return Hn(e)&&sr(t)?ar(bn(e),t):function(n){var r=Yr(n,e);return r===void 0&&r===t?Qr(n,e):ir(t,r,3)}},eo=function(e){return e},no=function(e){return function(t){return t?.[e]}},ro=function(e){return function(t){return dr(t,e)}},oo=function(e){return Hn(e)?no(bn(e)):ro(e)},io=function(e){return typeof e=="function"?e:e==null?eo:typeof e=="object"?At(e)?to(e[0],e[1]):Ur(e):oo(e)},so=function(e,t){var n={};return t=io(t,3),an(e,function(r,s,a){Qe(n,t(r,s,a),r)}),n};function pr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ao{constructor(t,n){pr(this,"ctx",void 0),pr(this,"serviceHooks",void 0),this.ctx=t,this.serviceHooks=n,t._execCallableAPI("register-search-service",t.baseInfo.id,n.name,n.options),Object.entries({query:{f:"onQuery",args:["graph","q",!0],reply:!0,transformOutput:r=>(At(r?.blocks)&&(r.blocks=r.blocks.map(s=>s&&so(s,(a,c)=>`block/${c}`))),r)},rebuildBlocksIndice:{f:"onIndiceInit",args:["graph","blocks"]},transactBlocks:{f:"onBlocksChanged",args:["graph","data"]},truncateBlocks:{f:"onIndiceReset",args:["graph"]},removeDb:{f:"onGraph",args:["graph"]}}).forEach(([r,s])=>{let a=(c=>`service:search:${c}:${n.name}`)(r);t.caller.on(a,async c=>{if(ft(n?.[s.f])){let m=null;try{m=await n[s.f].apply(n,(s.args||[]).map(O=>{if(c){if(O===!0)return c;if(c.hasOwnProperty(O)){let P=c[O];return delete c[O],P}}})),s.transformOutput&&(m=s.transformOutput(m))}catch(O){console.error("[SearchService] ",O),m=O}finally{s.reply&&t.caller.call(`${a}:reply`,m)}}})})}}function Ht(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let lo=Symbol.for("proxy-continue"),co=g()("LSPlugin:user"),fr=new R("",{console:!0});function Fe(e,t,n){var r;let{key:s,label:a,desc:c,palette:m,keybinding:O,extras:P}=t;if(typeof n!="function")return this.logger.error(`${s||a}: command action should be function.`),!1;let Z=function(z){if(typeof z=="string")return z.trim().replace(/\s/g,"_").toLowerCase()}(s);if(!Z)return this.logger.error(`${a}: command key is required.`),!1;let D=`SimpleCommandHook${Z}${++gr}`;this.Editor["on"+D](n),(r=this.caller)===null||r===void 0||r.call("api:call",{method:"register-plugin-simple-command",args:[this.baseInfo.id,[{key:Z,label:a,type:e,desc:c,keybinding:O,extras:P},["editor/hook",D]],m]})}function hr(e){return!(typeof(t=e)!="string"||t.length!==36||!/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi.test(t))||(fr.error(`#${e} is not a valid UUID string.`),!1);var t}let _n=null,mr=new Map,uo={async getInfo(e){return _n||(_n=await this._execCallableAPIAsync("get-app-info")),typeof e=="string"?_n[e]:_n},registerCommand:Fe,registerSearchService(e){if(mr.has(e.name))throw new Error(`SearchService: #${e.name} has registered!`);mr.set(e.name,new ao(this,e))},registerCommandPalette(e,t){let{key:n,label:r,keybinding:s}=e;return Fe.call(this,"$palette$",{key:n,label:r,palette:!0,keybinding:s},t)},registerCommandShortcut(e,t,n={}){typeof e=="string"&&(e={mode:"global",binding:e});let{binding:r}=e,s="$shortcut$",a=n.key||s+x(r?.toString());return Fe.call(this,s,{...n,key:a,palette:!1,keybinding:e},t)},registerUIItem(e,t){var n;let r=this.baseInfo.id;(n=this.caller)===null||n===void 0||n.call("api:call",{method:"register-plugin-ui-item",args:[r,e,t]})},registerPageMenuItem(e,t){if(typeof t!="function")return!1;let n=e+"_"+this.baseInfo.id,r=e;Fe.call(this,"page-menu-item",{key:n,label:r},t)},onBlockRendererSlotted(e,t){if(!hr(e))return;let n=this.baseInfo.id,r=`hook:editor:${x(`slot:${e}`)}`;return this.caller.on(r,t),this.App._installPluginHook(n,r),()=>{this.caller.off(r,t),this.App._uninstallPluginHook(n,r)}},invokeExternalPlugin(e,...t){var n;if(!(e=(n=e)===null||n===void 0?void 0:n.trim()))return;let[r,s]=e.split(".");if(!["models","commands"].includes(s?.toLowerCase()))throw new Error("Type only support '.models' or '.commands' currently.");let a=e.replace(`${r}.${s}.`,"");if(!r||!s||!a)throw new Error(`Illegal type of #${e} to invoke external plugin.`);return this._execCallableAPIAsync("invoke_external_plugin_cmd",r,s.toLowerCase(),a,t)},setFullScreen(e){let t=(...n)=>this._callWin("setFullScreen",...n);e==="toggle"?this._callWin("isFullScreen").then(n=>{n?t():t(!0)}):e?t(!0):t()}},gr=0,po={newBlockUUID(){return this._execCallableAPIAsync("new_block_uuid")},registerSlashCommand(e,t){var n;co("Register slash command #",this.baseInfo.id,e,t),typeof t=="function"&&(t=[["editor/clear-current-slash",!1],["editor/restore-saved-cursor"],["editor/hook",t]]),t=t.map(r=>{let[s,...a]=r;if(s==="editor/hook"){let c=a[0],m=()=>{var P;(P=this.caller)===null||P===void 0||P.callUserModel(c)};typeof c=="function"&&(m=c);let O=`SlashCommandHook${s}${++gr}`;r[1]=O,this.Editor["on"+O](m)}return r}),(n=this.caller)===null||n===void 0||n.call("api:call",{method:"register-plugin-slash-command",args:[this.baseInfo.id,[e,t]]})},registerBlockContextMenuItem(e,t){if(typeof t!="function")return!1;let n=e+"_"+this.baseInfo.id;Fe.call(this,"block-context-menu-item",{key:n,label:e},t)},registerHighlightContextMenuItem(e,t,n){if(typeof t!="function")return!1;let r=e+"_"+this.baseInfo.id;Fe.call(this,"highlight-context-menu-item",{key:r,label:e,extras:n},t)},scrollToBlockInPage(e,t,n){let r="block-content-"+t;n!=null&&n.replaceState?this.App.replaceState("page",{name:e},{anchor:r}):this.App.pushState("page",{name:e},{anchor:r})}},fo={onBlockChanged(e,t){if(!hr(e))return;let n=this.baseInfo.id,r=`hook:db:${x(`block:${e}`)}`,s=({block:a,txData:c,txMeta:m})=>{a.uuid===e&&t(a,c,m)};return this.caller.on(r,s),this.App._installPluginHook(n,r),()=>{this.caller.off(r,s),this.App._uninstallPluginHook(n,r)}},datascriptQuery(e,...t){return t.pop(),t!=null&&t.some(n=>typeof n=="function")?this.Experiments.ensureHostScope().logseq.api.datascript_query(e,...t):this._execCallableAPIAsync("datascript_query",e,...t)}},ho={},mo={},go={makeSandboxStorage(){return new lt(this,{assets:!0})}};class Wn extends p(){constructor(t,n){super(),Ht(this,"_baseInfo",void 0),Ht(this,"_caller",void 0),Ht(this,"_version","0.0.17"),Ht(this,"_debugTag",""),Ht(this,"_settingsSchema",void 0),Ht(this,"_connected",!1),Ht(this,"_ui",new Map),Ht(this,"_mFileStorage",void 0),Ht(this,"_mRequest",void 0),Ht(this,"_mExperiments",void 0),Ht(this,"_beforeunloadCallback",void 0),this._baseInfo=t,this._caller=n,n.on("sys:ui:visible",r=>{r!=null&&r.toggle&&this.toggleMainUI()}),n.on("settings:changed",r=>{let s=Object.assign({},this.settings),a=Object.assign(this._baseInfo.settings,r);this.emit("settings:changed",{...a},s)}),n.on("beforeunload",async r=>{let{actor:s,...a}=r,c=this._beforeunloadCallback;try{c&&await c(a),s?.resolve(null)}catch(m){this.logger.error("[beforeunload] ",m),s?.reject(m)}})}async ready(t,n){var r,s;if(!this._connected)try{var a;typeof t=="function"&&(n=t,t={});let c=await this._caller.connectToParent(t);this._connected=!0,r=this._baseInfo,s=c,c=j()(r,s,{arrayMerge:(m,O)=>O}),this._baseInfo=c,(a=c)!==null&&a!==void 0&&a.id&&(this._debugTag=this._caller.debugTag=`#${c.id} [${c.name}]`,this.logger.setTag(this._debugTag)),this._settingsSchema&&(c.settings=function(m,O){let P=(O||[]).reduce((Z,D)=>("default"in D&&(Z[D.key]=D.default),Z),{});return Object.assign(P,m)}(c.settings,this._settingsSchema),await this.useSettingsSchema(this._settingsSchema));try{await this._execCallableAPIAsync("setSDKMetadata",{version:this._version})}catch(m){console.warn(m)}n&&n.call(this,c)}catch(c){console.error(`${this._debugTag} [Ready Error]`,c)}}ensureConnected(){if(!this._connected)throw new Error("not connected")}beforeunload(t){typeof t=="function"&&(this._beforeunloadCallback=t)}provideModel(t){return this.caller._extendUserModel(t),this}provideTheme(t){return this.caller.call("provider:theme",t),this}provideStyle(t){return this.caller.call("provider:style",t),this}provideUI(t){return this.caller.call("provider:ui",t),this}useSettingsSchema(t){return this.connected&&this.caller.call("settings:schema",{schema:t,isSync:!0}),this._settingsSchema=t,this}updateSettings(t){this.caller.call("settings:update",t)}onSettingsChanged(t){let n="settings:changed";return this.on(n,t),()=>this.off(n,t)}showSettingsUI(){this.caller.call("settings:visible:changed",{visible:!0})}hideSettingsUI(){this.caller.call("settings:visible:changed",{visible:!1})}setMainUIAttrs(t){this.caller.call("main-ui:attrs",t)}setMainUIInlineStyle(t){this.caller.call("main-ui:style",t)}hideMainUI(t){let n={key:0,visible:!1,cursor:t?.restoreEditingCursor};this.caller.call("main-ui:visible",n),this.emit("ui:visible:changed",n),this._ui.set(n.key,n)}showMainUI(t){let n={key:0,visible:!0,autoFocus:t?.autoFocus};this.caller.call("main-ui:visible",n),this.emit("ui:visible:changed",n),this._ui.set(n.key,n)}toggleMainUI(){let n=this._ui.get(0);n&&n.visible?this.hideMainUI():this.showMainUI()}get version(){return this._version}get isMainUIVisible(){let t=this._ui.get(0);return!!(t&&t.visible)}get connected(){return this._connected}get baseInfo(){return this._baseInfo}get effect(){return(t=this)&&(((n=t.baseInfo)===null||n===void 0?void 0:n.effect)||!((r=t.baseInfo)!==null&&r!==void 0&&r.iir));var t,n,r}get logger(){return fr}get settings(){var t;return(t=this.baseInfo)===null||t===void 0?void 0:t.settings}get caller(){return this._caller}resolveResourceFullUrl(t){if(this.ensureConnected(),t)return t=t.replace(/^[.\\/]+/,""),T(this._baseInfo.lsr,t)}_makeUserProxy(t,n){let r=this,s=this.caller;return new Proxy(t,{get(a,c,m){let O=a[c];return function(...P){if(O){let D=O.apply(r,P.concat(n));if(D!==lo)return D}if(n){let D=c.toString().match(/^(once|off|on)/i);if(D!=null){let z=D[0].toLowerCase(),K=D.input,V=z==="off",Q=r.baseInfo.id,st=K.slice(z.length),bt=P[0],It=P[1];typeof bt=="string"&&typeof It=="function"&&(bt=bt.replace(/^logseq./,":"),st=`${st}${bt}`,bt=It,It=P[2]),st=`hook:${n}:${x(st)}`,s[z](st,bt);let Ce=()=>{s.off(st,bt),s.listenerCount(st)||r.App._uninstallPluginHook(Q,st)};return V?void Ce():(r.App._installPluginHook(Q,st,It),Ce)}}let Z=c;return["git","ui","assets"].includes(n)&&(Z=n+"_"+Z),s.callAsync("api:call",{tag:n,method:Z,args:P})}}})}_execCallableAPIAsync(t,...n){return this._caller.callAsync("api:call",{method:t,args:n})}_execCallableAPI(t,...n){this._caller.call("api:call",{method:t,args:n})}_callWin(...t){return this._execCallableAPIAsync("_callMainWin",...t)}get App(){return this._makeUserProxy(uo,"app")}get Editor(){return this._makeUserProxy(po,"editor")}get DB(){return this._makeUserProxy(fo,"db")}get Git(){return this._makeUserProxy(ho,"git")}get UI(){return this._makeUserProxy(mo,"ui")}get Assets(){return this._makeUserProxy(go,"assets")}get FileStorage(){let t=this._mFileStorage;return t||(t=this._mFileStorage=new lt(this)),t}get Request(){let t=this._mRequest;return t||(t=this._mRequest=new Lt(this)),t}get Experiments(){let t=this._mExperiments;return t||(t=this._mExperiments=new Ct(this)),t}}function yr(e,t){return new Wn(e,t)}if(window.__LSP__HOST__==null){let e=new ee(null);window.logseq=yr({},e)}})(),ut})())});var Fo=Co(br(),1);var _r=`#logseq-live-math--popup-screen {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

div[data-ref='logseq-live-math'] {
  & .ls-ui-float-content {
    background-color: var(--ls-secondary-background-color);
  }

  & .actions {
    display: flex;
    align-items: center;
    justify-content: space-around;
    margin: 5px 0;

    & button {
      font-family: tabler-icons, ui-font, system-ui;
      font-weight: bold;
      font-size: small;

      &.clear-button {
        color: var(--ls-error-color);
      }
      &.reset-button {
        color: var(--ls-warning-color);
      }
      &.confirm-button {
        color: var(--ls-success-color);
      }
      &:disabled {
        color: var(--ls-secondary-text-color);
      }
    }
  }

  & math-field {
    outline: none;
    border-radius: 0;
    color: var(--ls-primary-text-color);
    background-color: var(--ls-secondary-background-color);
    --contains-highlight-background-color: var(--ls-block-highlight-color);
    --selection-background-color: var(--ls-selection-background-color);
    --primary: var(--ls-primary-theme-color, var(--ls-wb-text-color-blue));
    --text-font-family: KaTeX_Main, 'Times New Roman', serif;
    --ui-menu-bg: var(--ls-secondary-background-color);
    --ui-menu-bg-active: var(--ls-selection-background-color);
    --ui-menu-text-active: var(--ls-selection-text-color);
    --neutral-200: var(--ls-secondary-background-color);
    --neutral-100: var(--ls-secondary-background-color);

    &::part(virtual-keyboard-toggle):hover {
      background-color: var(--ls-primary-background-color);
      color: var(--ls-primary-text-color);
    }
    /* Hide 'Toggle Virtual Keyboard' tooltip which spoils popup layout */
    &::part(virtual-keyboard-toggle)::after {
      display: none !important;
    }
    &::part(container) {
      min-width: 200px; /* for inline math-field */
    }
  }
}

.ML__keyboard {
  --keyboard-background: var(--ls-secondary-background-color);
  --keyboard-accent-color: var(--ls-primary-theme-color, var(--ls-wb-text-color-blue));
  --keyboard-toolbar-text: var(--ls-primary-text-color);
  --keyboard-toolbar-background-hover: var(--ls-primary-background-color) !important;
  --keycap-background: var(--ls-primary-background-color);
  --keycap-text: var(--ls-secondary-text-color);
  --keycap-secondary-background: var(--ls-tertiary-background-color);
  --keycap-secondary-text: var(--ls-secondary-text-color);
}

div#mathlive-suggestion-popover {
  background-color: var(--ls-primary-background-color);
  z-index: var(--ls-z-index-level-2);

  & ul {
    padding: 8px;
    /* Limit min-width to reduce clutter */
    min-width: 16ch;
    gap: 0.25rem;
  }

  & li {
    /* Suggestion item */
    margin: 0;
    padding: 0.25rem;
    border-radius: 4px;
    width: 100%;
    gap: 0;

    &.ML__popover__current {
      background-color: var(--ls-selection-background-color);
      color: var(--ls-selection-text-color);
    }

    & .ML__popover__latex {
      flex-grow: 1;
      text-align: start;
      margin-right: 0.5rem;
    }

    & .ML__popover__command {
      font-size: 1rem;
    }
  }
}

div#mathlive-suggestion-popover.top-tip::after {
  border-bottom-color: var(--ls-primary-background-color);
}

div#mathlive-suggestion-popover.bottom-tip::after {
  border-top-color: var(--ls-primary-background-color);
}
`;var wr=[{title:"Triggers",description:"",key:"triggerSettings",type:"heading",default:null},{title:"Enable `$$` trigger",description:"MathLive will popup if `$$` is typed. You can still use inline math.",key:"dollarTrigger",type:"boolean",default:!0},{title:"Enable select-and-edit",description:"Select the math expression (including `$`s) and MathLive will pop up.",key:"selectEdit",type:"boolean",default:!0},{title:"Modifier key for select-and-edit",description:"Require modifier key to be pressed while selecting for MathLive to pop up.",key:"selectModifier",type:"enum",default:"<none>",enumPicker:"select",enumChoices:["<none>","Control","Shift","Alt","Control+Shift","Control+Alt","Shift+Alt"]},{title:"Formatting",description:"",key:"formatSettings",type:"heading",default:null},{title:"Prefer display mode",description:"When enabled, math will be inserted as display mode, i.e. `$$`.",key:"preferDisplay",type:"boolean",default:!1},{title:"Prefer multiline for display math",description:"Use `$$\\n...\\n$$` instead of `$$...$$` for display math.",key:"preferMultiline",type:"boolean",default:!1},{title:"Smart format",description:"Determine inline or display mode for new math: inline for middle of the line and display for start of newline (not new block). `preferDisplay` option will be honored in case of ambiguity.",key:"smartFormat",type:"boolean",default:!0},{title:"MathLive",description:"",key:"mathliveSettings",type:"heading",default:null},{title:"Inline preview",description:"Use inline mode of MathLive if current math is inline mode.",key:"inlinePreview",type:"boolean",default:!1},{title:"Smart Fence",description:"Automatically convert parentheses to `\\left...\\right` markup.",key:"smartFence",type:"boolean",default:!0},{title:"Smart mode",description:"Switch to text mode when text input is detected, for example when typing `if x > 0`.",key:"smartMode",type:"boolean",default:!1},{title:"Smart superscript",description:"Automatically move out of a superscript when a digit is typed.",key:"smartSuperscript",type:"boolean",default:!1},{title:"Key bindings",description:"Configure [MathLive keybindings](https://cortexjs.io/mathlive/guides/shortcuts/#key-bindings).\n\nBy default, this plugin includes `ctrl+b` to insert `\\mathbf` as an example. You can add your own and delete this example if you don't want it.\n\nYou can also check [this discussion](https://github.com/AllanChain/logseq-live-math/discussions/14) for more examples.",key:"keybindings",type:"object",default:[{key:"ctrl+b",command:["insert","\\mathbf{#@}"]}]},{title:"Inline shortcuts",description:`Configure [MathLive inline shortcuts](https://cortexjs.io/mathlive/guides/shortcuts/#inline-shortcuts).

By default, this plugin inserts aligned placeholder when you type \`align\` as an example. You can add your own and delete this example if you don't want it.

You can also check [this discussion](https://github.com/AllanChain/logseq-live-math/discussions/14) for more examples.`,key:"inlineShortcuts",type:"object",default:{align:`\\begin{align*}
#? &= #? \\\\
 #? &= #?\\end{align*}`}},{title:"Macros",description:`Configure [MathLive macros](https://cortexjs.io/mathlive/guides/macros/).

One trick is to copy over default macros with \`expand: false\` to avoid automatic macro expansion.

**Note**: MathLive have [bugs](https://github.com/arnog/mathlive/issues/1565) with \`expand: false\`, Use it with caution.

You can also check [this discussion](https://github.com/AllanChain/logseq-live-math/discussions/14) for more examples.`,key:"macros",type:"object",default:{phase:{def:"\\enclose{phasorangle}{#1}",args:1,captureSelection:!1,expand:!1}}},{title:"Disable default shortcuts",description:"Disable default inline shortcuts defined by MathLive.",key:"disableDefaultShortcuts",type:"boolean",default:!1}];function xr(W){W.smartFence=logseq.settings?.smartFence??!0,W.smartMode=logseq.settings?.smartMode??!1,W.smartSuperscript=logseq.settings?.smartSuperscript??!1,W.menuItems=W.menuItems.filter(G=>!G.id?.startsWith("ce-"));try{W.keybindings=[...W.keybindings.filter(G=>!logseq.settings?.keybindings.some(U=>U.key===G.key&&U.ifMode===G.ifMode&&U.ifLayout===G.ifLayout&&U.ifPlatform===G.ifPlatform)),...logseq.settings?.keybindings.filter(G=>!!G.command)]}catch(G){logseq.UI.showMsg(`Fail to configure MathLive keybindings: ${G}`,"error")}try{W.inlineShortcuts={...logseq.settings?.disableDefaultShortcuts?null:W.inlineShortcuts,...logseq.settings?.inlineShortcuts}}catch(G){logseq.UI.showMsg(`Fail to configure MathLive inline shortcuts: ${G}`,"error")}try{W.macros={...W.macros,...logseq.settings?.macros}}catch(G){logseq.UI.showMsg(`Fail to configure MathLive macros: ${G}`,"error")}}async function Gn(W){return new Promise(G=>setTimeout(G,W))}async function Ve(W,G){let U=parent.document.querySelector(`textarea[id$="${W}"]`);if(U==null){console.warn("[live-math] Block changed!");return}let ut=U.value,F=G?.selectionEnd??U.selectionEnd,u=G?.selectionStart??U.selectionStart,j="",v=logseq.settings?.preferDisplay?"$$":"$",d=logseq.settings?.preferMultiline?`
`:"";if(G?.searchMath&&u===F)for(let $ of ut.matchAll(/(\$+)([^$]+)\1/g))$.index<=u&&u<=$.index+$[0].length&&(u=$.index,F=u+$[0].length);let A=U.value.substring(u,F);for(;ut.charAt(F)==="$";)F++;for(;ut.charAt(u-1)==="$";)u--;let J=ut.substring(0,u),w=ut.substring(F,ut.length);if(A){let $=A.match(/^(?<delim>\$+)(?<newline>\n*)(?<content>.*)\2\1$/s);$!==null&&$.groups!==void 0&&(j=$.groups.content,v=$.groups.delim,v!=="$"&&(d=$.groups.newline))}else logseq.settings?.smartFormat&&J.length>0&&(J[J.length-1]===`
`?v="$$":v="$");let h="logseq-live-math--popup-screen",k=parent.document.getElementById(h);k!==null&&parent.document.body.removeChild(k);let p=parent.document.createElement("div");p.id=h,parent.document.body.appendChild(p),logseq.provideUI({key:"popup",template:""}),logseq.provideUI({key:"popup",template:"<span></span>",style:await kr({multiline:v==="$$"&&!!d,renew:!0}),attrs:{title:"Click title to switch display and inline style"}}),await Gn(0);let _=parent.document.getElementById("logseq-live-math--popup");if(_===null)return;let b=_.querySelector(".ls-ui-float-content");if(b===null)return;b.title="",b.addEventListener("pointerdown",$=>$.stopPropagation());let x=parent.document.createElement("math-field");x.style.display="block",b.prepend(x),x.value=j,logseq.settings?.inlinePreview&&v==="$"&&(x.defaultMode="inline-math");let R=parent.document.createElement("button");R.innerText=v==="$"?"Inline Math":"Display Math",R.classList.add("delim-switch"),_.querySelector(".th > .l > h3")?.replaceChildren(R);let M=parent.document.createElement("div");M.classList.add("actions");let i=parent.document.createElement("button");i.innerHTML="&#xef88; Clear",i.title="Empty this math",i.classList.add("clear-button"),M.appendChild(i);let l=parent.document.createElement("button");l.innerHTML="&#xea0c; Reset",l.title="Reset as before your edit",l.classList.add("reset-button"),A.length===0&&(l.disabled=!0),M.appendChild(l);let g=parent.document.createElement("button");g.innerHTML="&#xea5e; Done",g.title="Finish editing",g.classList.add("confirm-button"),M.appendChild(g),b.appendChild(M),await Gn(0),x.focus(),xr(x),await Gn(0);async function y(){let $=await kr({multiline:v==="$$"&&!!d});$!==void 0&&_!==null&&(Object.entries($).forEach(([xt,f])=>{_.style.setProperty(xt,f)}),_.dataset.dx="0",_.dataset.dy="0",_.style.transform="unset")}y(),parent.addEventListener("resize",y),_.addEventListener("mousedown",$=>$.stopPropagation()),_.querySelector(".draggable-handle")?.addEventListener("mouseup",y);let B=!1,tt=$=>{let xt=$.match(/^\{\\displaylines(?<content>.*)\}$/s);return xt!==null&&xt.groups!==void 0&&($=`\\begin{gather*}${xt.groups.content}\\end{gather*}`),v!=="$"&&logseq.settings?.preferMultiline&&($=$.replaceAll("\\\\ ",`\\\\
`).replaceAll(/(\\begin\{[^}]+\})/g,`
$1
`).replaceAll(/(\\end\{[^}]+\})/g,`
$1
`).replaceAll(/\n+/g,`
`).trim()),v==="$"?v+$+v:v+d+$+d+v},et=async()=>{let $=tt(x.getValue("latex-expanded")),xt=x.value?J+$:J;return await logseq.Editor.updateBlock(W,xt+w),xt},at=async()=>{v=v==="$"?"$$":"$",R.innerText=v==="$"?"Inline Math":"Display Math",logseq.settings?.inlinePreview&&(x.defaultMode=v==="$"?"inline-math":"math",x.value=x.value),await et()},ht="";R.addEventListener("mousedown",$=>{ht=`${$.x},${$.y}`}),R.addEventListener("mouseup",async $=>{ht===`${$.x},${$.y}`&&(ht="",await at())}),x.addEventListener("keydown",async $=>{$.key==="$"&&$.ctrlKey&&await at(),$.stopPropagation()}),i.addEventListener("click",async()=>{x.value="",await et()}),l.addEventListener("click",async()=>{x.value=A,await logseq.Editor.updateBlock(W,J+A+w)}),x.onExport=($,xt,f)=>tt($.getValue(f,"latex-expanded")),x.addEventListener("input",async()=>{await y(),!x.value.includes("placeholder")&&await et()}),x.addEventListener("unmount",async()=>{parent.removeEventListener("resize",y),parent.document.body.removeChild(p)});let mt=async()=>{if(B)return;B=!0,logseq.provideUI({key:"popup",template:""});let $=await et();parent.document.contains(U)?(U.focus(),U.selectionStart=$.length,U.selectionEnd=$.length):logseq.Editor.editBlock(W,{pos:$.length})};g.addEventListener("click",mt),x.addEventListener("change",async()=>{x.hasFocus()&&await mt()}),p.addEventListener("click",mt),_.addEventListener("keydown",async $=>{$.target!==x&&$.key==="Enter"&&await mt(),$.stopPropagation()})}function Ke(W){return parseInt(W.substring(0,W.length-2),10)}async function kr(W){let U=W?.multiline??!1?60:30,ut=20,F=300,u=parent.document.documentElement.clientWidth,j=parent.document.documentElement.clientHeight,v=parent.document.getElementById("logseq-live-math--popup"),d;if(v===null||W?.renew){let A=await logseq.Editor.getEditingCursorPosition();if(A===null){console.error("Error getting cursor pos");return}d={width:F,marginLeft:10,marginRight:10,left:0,top:0,bottom:0},d.left=A.rect.left+A.left-d.width/4-d.marginLeft,d.top=A.rect.top+A.top+U}else{let A=v.querySelector("math-field")?.shadowRoot?.querySelector(".ML__content"),J=A?A.scrollWidth-A.offsetWidth-10:0;d={width:Math.max(F,v.offsetWidth+J),marginLeft:Ke(v.style.marginLeft),marginRight:Ke(v.style.marginLeft),left:Ke(v.style.left)+parseInt(v.dataset.dx??"0"),top:v.style.top==="initial"?0:Ke(v.style.top)+parseInt(v.dataset.dy??"0"),bottom:v.style.bottom==="initial"?0:Ke(v.style.bottom)-parseInt(v.dataset.dy??"0")}}return d.width+d.marginLeft+d.marginRight>u?(d.left=0,d.width=u-d.marginLeft-d.marginRight):(d.left<0&&(d.left=d.marginLeft),d.left+d.width+d.marginRight>u&&(d.left=u-d.marginRight-d.width)),d.top<0&&(d.top=U),d.bottom<0&&(d.bottom=ut),d.top!==0&&d.top+100>j&&(d.bottom=j-d.top+U+ut,d.top=0),d.bottom!==0&&d.bottom+100>j&&(d.top=U,d.bottom=0),{left:d.left+"px",top:d.top?d.top+"px":"initial",bottom:d.bottom?d.bottom+"px":"initial",width:d.width+"px",marginLeft:d.marginLeft+"px",marginRight:d.marginRight+"px"}}function Eo(){let W=parent.document.createElement("script");return W.setAttribute("src",`${logseq.baseInfo.lsr}dist/parent.js`),parent.document.body.appendChild(W),()=>parent.document.body.removeChild(W)}function Oo(){let W=Eo();logseq.provideStyle(_r),logseq.useSettingsSchema(wr),logseq.Editor.registerSlashCommand("math",async U=>{Ve(U.uuid)}),logseq.App.registerCommandShortcut({binding:"mod+shift+m"},async()=>{let U=await logseq.Editor.getCurrentBlock();U!==null&&await Ve(U.uuid,{searchMath:!0})}),logseq.Editor.onInputSelectionEnd(async U=>{if(logseq.settings?.disabled||!logseq.settings?.selectEdit)return;if(logseq.settings?.selectModifier!=="<none>"){let F=parent.document.body.dataset.activeKeystroke?.split("+"),u=logseq.settings?.selectModifier.split("+");if(F===void 0||u===void 0||u.some(j=>!F.includes(j)))return}if(U.text.length<=2||!U.text.match(/^(\$+)([^$]+)\1$/))return;let ut=await logseq.Editor.getCurrentBlock();ut!==null&&Ve(ut.uuid,{selectionStart:U.start,selectionEnd:U.end})});let G=async U=>{if(logseq.settings?.disabled||!logseq.settings?.dollarTrigger||U.key!=="$")return;let ut=await logseq.Editor.getEditingCursorPosition();if(ut===null)return;let F=parent.document.getElementById("mock-text")?.textContent,u=await logseq.Editor.getCurrentBlock();u!==null&&ut.pos>1&&F?.charAt(ut.pos-2)==="$"&&Ve(u.uuid)};parent.addEventListener("keydown",G),logseq.beforeunload(async()=>{parent.removeEventListener("keydown",G),W()})}logseq.ready(Oo).catch(logseq.UI.showMsg);})();
/*! Bundled license information:

@logseq/libs/dist/lsplugin.user.js:
  (*! For license information please see lsplugin.user.js.LICENSE.txt *)
*/
